<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="SocketÁºñÁ®ãÂÆûÈ™å
‰∏Ä„ÄÅÂÆûÈ™åË¶ÅÊ±Ç
1.1 ÂÆûÈ™åÁõÆÊ†áÂíåÂÜÖÂÆπ
1.1.1 ÂÆûÈ™åÁõÆÁöÑ
‚óè ‰∫ÜËß£Â∫îÁî®Â±ÇÂíåËøêËæìÂ±ÇÁöÑ‰ΩúÁî®ÂèäÁõ∏ÂÖ≥ÂçèËÆÆÁöÑÂ∑•‰ΩúÂéüÁêÜÂíåÊú∫Âà∂„ÄÇ
‚óè ÊéåÊè° SOCKET ÁºñÁ®ãÁöÑÂü∫Êú¨ÊñπÊ≥ï„ÄÇ
1.1.2 ÂÆûÈ™åÁéØÂ¢É
‚óè Êìç‰ΩúÁ≥ªÁªüÔºöWindows
‚óè ËØ≠..." />
    <meta name="keywords" content="C/C++" />
    <link rel="stylesheet" href="https://2006wzt.github.io/media/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://2006wzt.github.io/styles/main.css">
    <!-- ‰ª£Á†ÅÊ∏≤ÊüìÈ£éÊ†ºcss -->
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/dracula.min.css">
    
    <!-- ‰ª£Á†ÅÈ´ò‰∫ÆÊèí‰ª∂ -->
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>
    <!-- ‰ª£Á†ÅÂ§çÂà∂Êèí‰ª∂ -->
    <script src="https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/clipboard.min.js"></script>
    <!-- live2dÊèí‰ª∂ -->
    <link rel="stylesheet" href="https://2006wzt.github.io/media/css/live2d.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
    <!-- ÊúÄÊñ∞ÁâàÊú¨ÁöÑ Bootstrap Ê†∏ÂøÉ CSS Êñá‰ª∂ -->
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.13.1/css/all.min.css" rel="stylesheet">
    <!-- Êï∞Â≠¶ÂÖ¨Âºè -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css"
        integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js"
        integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous">
        </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js"
        integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous">
        </script>
    <script>
        renderMathInElement(document.body, {
            delimiters: [{
                left: "$$",
                right: "$$",
                display: true
            },
            {
                left: "$",
                right: "$",
                display: false
            }
            ]
        });
    </script>
    
    <title>SocketÁºñÁ®ãÂÆûÈ™å</title>

    <!-- Â§ßÁ∫≤Á¥¢ÂºïcssË∞ÉÊï¥ -->
    
    <style>
        .markdownIt-TOC {
            margin-left: 28%;
            padding-left: 2px;
            width: 80%;
        }

        .markdownIt-TOC li {
            padding-left: 8%;
        }
    </style>
    
</head>

<body>
    <div id="landlord">
        <div class="message" style="opacity:0"></div>
        <canvas id="live2d" width="240" height="250" class="live2d"></canvas>
    </div>
    <div id="domainname" style="display:none">https://2006wzt.github.io</div>
    <div id="content">
        <div>
            <!----------- ÁßªÂä®Á´ØÂØºËà™Ê†èüëá ----------------->
            <div id="bar">
                <style>
  .navmobile {
    z-index: 15;
    max-height: 40vh;
    overflow-y: scroll;
    overflow-x: hidden;
  }

  @media screen and (max-width: 1200px) {
    .navbar {
      max-width: 100vw;
    }
  }

  @media screen and (max-width:1200px) and (min-width: 768px) {
    @media (min-width: 768px) {
      .navbar-nav {
        float: right;
        margin: 0;
      }
    }
  }

  @media screen and (max-width:768px) {
    .mbapspan {
      padding: 0;
    }
  }
</style>
<div class="pjaxloading"  onclick="pjaxloadingClose()">
  <div class="loadingbackground"></div>
  <div id="loading">
    <div class="loading">
    </div>
  </div>
</div>
<nav class="navbar navbar-inverse navbar-fixed-top navmobile">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#barmenu"
        aria-expanded="false" id="barbutton">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a data-pjax class="navbar-brand" style="color:white" href="https://2006wzt.github.io">My Brain&nbsp;&nbsp;|</a>
      <span class="navbar-brand mbapspan"><i id="mbaplayer" class="fa fa-play-circle-o" aria-hidden="true"
          style="font-size: 28px;top: 12px;position: absolute;" onclick="aplayerPlay();"></i></span>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="barmenu">
      <ul class="nav navbar-nav">
        
        
        <li>
          <a data-pjax href="/" style="color:white">
            È¶ñÈ°µ
          </a>
        </li>
        
        
        
        <li>
          <a data-pjax href="/archives" style="color:white">
            ÂΩíÊ°£
          </a>
        </li>
        
        
        
        <li>
          <a data-pjax href="/tags" style="color:white">
            Ê†áÁ≠æ
          </a>
        </li>
        
        
        
        <li>
          <a data-pjax href="/post/about" style="color:white">
            ÂÖ≥‰∫é
          </a>
        </li>
        
        
        
        
          
        <li><a data-pjax href="https://2006wzt.github.io/friends" style="color:white">ÂèãÈìæ</a></li>

        
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>


  <!-- ÂºïÂÖ•jQueryÊ†∏ÂøÉjsÊñá‰ª∂ -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  <script>
    let btstate = false;
    var bt = $("#barbutton");
    var bm = $("#barmenu");
    bt.click(function () {
      dropdown();
    })
    function dropdown() {
      console.log(btstate);
      //‰∏ãÊãâ
      if (btstate == false) {
        bt.removeClass("collapsed");
        bt.attr("aria-expanded", "true");
        bm.attr("aria-expanded", "true")
        bm.fadeIn(700);
        btstate = true;
      }
      else {
        bt.addClass("collapsed");
        bt.attr("aria-expanded", "false");
        bm.removeClass("in");
        bm.hide();
        bm.attr("aria-expanded", "false");
        btstate = false;
      }
    }
  </script> 
            </div>
            <!----------- ÁßªÂä®Á´ØÂØºËà™Ê†èüëÜ ----------------->

            <!--------------- pcÁ´ØËèúÂçïÊ†èüëá ---------------->
            <div class="side"><head>
    <link rel="stylesheet" href="https://2006wzt.github.io/media/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://2006wzt.github.io/styles/main.css">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/dracula.min.css">
    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/clipboard.min.js"></script>
    <link rel="stylesheet" href="https://2006wzt.github.io/media/css/live2d.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <!-- ÊúÄÊñ∞ÁâàÊú¨ÁöÑ Bootstrap Ê†∏ÂøÉ CSS Êñá‰ª∂ -->
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.13.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- fancybox -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


    <!--------- Êï∞Â≠¶ÂÖ¨Âºèüëá---- -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css"
        integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js"
        integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js"
        integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous">
    </script>
    <script>
        renderMathInElement(document.body, {
            delimiters: [{
                    left: "$$",
                    right: "$$",
                    display: true
                },
                {
                    left: "$",
                    right: "$",
                    display: false
                }
            ]
        });
    </script>
    
    <!--------- Êï∞Â≠¶ÂÖ¨ÂºèüëÜ----------------- -->
    <!--------- daovocieÂäüËÉΩüëá ------------------->
    
    <!--------- daovocieÂäüËÉΩüëÜ ------------------->
    <!-- -----------------twikooËØÑËÆ∫Á≥ªÁªüÂºïÂÖ•üëá --------->
    <script src="https://cdn.jsdelivr.net/npm/twikoo@1.3.1/dist/twikoo.all.min.js"></script>
    <!-- -----------------twikooËØÑËÆ∫Á≥ªÁªüÂºïÂÖ•üëÜ --------->
    <!---------------- leancloud api ÂäüËÉΩ‰æùËµñÂºïÂÖ•üëá -------->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.13.0/dist/av-min.js"></script>
    <!---------------- leancloud api ÂäüËÉΩ‰æùËµñÂºïÂÖ•üëÜ -------->
    <!------------------ valineËØÑËÆ∫Á≥ªÁªüÂºïÂÖ•üëá ------------------>
    <script src="https://2006wzt.github.io/media/js/valine.min.js"></script>
    <!------------------ valineËØÑËÆ∫Á≥ªÁªüÂºïÂÖ•üëÜ ------------------>
    <!---------------- ‰ªäÊó•ËØóËØçapiÂäüËÉΩ‰æùËµñüëá ----------------------->
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <!---------------- ‰ªäÊó•ËØóËØçapiÂäüËÉΩ‰æùËµñüëÜ ----------------------->
    <!---------------- ‰ªäÊó•ËØóËØçapiÂäüËÉΩ‰æùËµñüëá ----------------------->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ispeak-bber/ispeak-bber.min.js" charset="utf-8"></script>
    <!---------------- ÂìîÂìîÂäüËÉΩ‰æùËµñüëÜ ----------------------->


</head>

<style>
    body {
        overflow-x: hidden;
        height: 100vh;
        overflow-y: scroll;
        cursor: url("https://2006wzt.github.io/media/images/mouse_cursor.png"), auto
    }
</style>

<body>
    <!--=------ È°µÈù¢Âä†ËΩΩÂä®ÊÄÅÁîªÈù¢üëá --------------->
    <div class="pjaxloading" onclick="pjaxloadingClose()">
        <div class="loadingbackground"></div>
        <div id="loading-aname">
            <div class="loading-aname">
            </div>
        </div>
    </div>
    <!--=------ È°µÈù¢Âä†ËΩΩÂä®ÊÄÅÁîªÈù¢üëÜ --------------->

    <!--------------- Â∑¶‰æßËèúÂçïÊ†èüëá ------------------------>
    
    <div id=side>
        <div class="r_m_div">
            <a onclick="showAaplayer()"><i style="font-size: 20px;"><img
                        src='https://2006wzt.github.io/media/images/music.png' alt="Èü≥‰πêÊí≠ÊîæÂô®" class="musicbtn"></i></a>
        </div>
        <div class="avatar-border">
            <img src="https://2006wzt.github.io/images/avatar.png?v=1667749481680" class="avatar">
        </div>
        <div class="sitename">My Brain</div>
        <span class="description" data-text='["There is no end to learning. "]'>&nbsp;</span>
        <div class="siteinfocontainer">
            <span class="siteinfo">ÊñáÁ´†</span>
            <span class="siteinfo">Ê†áÁ≠æ</span>
        </div>
        <div class="siteinfocontainer">
            <span class="siteinfo" id="siteinfo-postsnum"></span>
            <span class="siteinfo">5</span>
        </div>
        
        <div class="search">
            <!-- <input type="text" class="search-input" placeholder="Ê†áÈ¢òÊêúÁ¥¢(‚óè'‚ó°'‚óè)" /> -->
            <input type="text" class="search-input" placeholder="Ê†áÈ¢òÊêúÁ¥¢ ‚öÜ_‚öÜ „Å§‚ô°">
            <div class="search-results"></div>
        </div>
        
    <div class="share-button">
        <span>Know meüòä</span>
        
        <a href="https://github.com/2006wzt" target="_blank"><i style="font-size: 20px;"><img class="icon"
                    src="https://2006wzt.github.io/media/images/github.png" alt=""></i></a>
        
        
        <a onclick="showqq()"><i style="font-size: 20px;"><img class="icon"
                    src="https://2006wzt.github.io/media/images/QQ.png" alt=""></i></a>
        
        
        
        <a href="https://space.bilibili.com/662167120" target="_blank"><i style="font-size: 20px;"><img class="icon"
                    src="https://2006wzt.github.io/media/images/bilibili.png" alt=""></i></a>
        
        
        
        
        
    </div>
    <div id="qq" style="display:none">1335287851</div>
    <!------------ Âä†ËΩΩËèúÂçïÊåâÈíÆüëá ------------------------->
    <div class="menucontainer">
        
        
        <div class="mchocie description">
            <a data-pjax href="/" class="menubutton" style="margin-right: 15px;">
                <i><img class="icon menuicon" src="" alt="È¶ñÈ°µ"></i>&nbsp;<span
                    data-text="È¶ñÈ°µ">È¶ñÈ°µ</span>
            </a>
        </div>
        
        
        
        <div class="mchocie description">
            <a data-pjax href="/archives" class="menubutton" style="margin-right: 15px;">
                <i><img class="icon menuicon" src="" alt="ÂΩíÊ°£"></i>&nbsp;<span
                    data-text="ÂΩíÊ°£">ÂΩíÊ°£</span>
            </a>
        </div>
        
        
        
        <div class="mchocie description">
            <a data-pjax href="/tags" class="menubutton" style="margin-right: 15px;">
                <i><img class="icon menuicon" src="" alt="Ê†áÁ≠æ"></i>&nbsp;<span
                    data-text="Ê†áÁ≠æ">Ê†áÁ≠æ</span>
            </a>
        </div>
        
        
        
        <div class="mchocie description">
            <a data-pjax href="/post/about" class="menubutton" style="margin-right: 15px;">
                <i><img class="icon menuicon" src="" alt="ÂÖ≥‰∫é"></i>&nbsp;<span
                    data-text="ÂÖ≥‰∫é">ÂÖ≥‰∫é</span>
            </a>
        </div>
        
        

        
        
        
        <div class="mchocie description">
            <a data-pjax href="https://2006wzt.github.io/friends" class="menubutton" style="margin-right: 15px;">
                <i><img class="icon menuicon" src="" alt="Âèã‰∫∫Â∏ê"></i>&nbsp;<span data-text="Âèã‰∫∫Â∏ê">Âèã‰∫∫Â∏ê</span>
            </a>
        </div>
        
        <!--  -->
    </div>
    <!------------ Âä†ËΩΩËèúÂçïÊåâÈíÆüëÜ ------------------------->
    <hr>
    <style>
    .copyright {
        font-size: 15px;
        color: #d9d9d9;
    }


    @media screen and (min-width: 1200px) {
        .foot {
            width: 100%;
            height: 130px;
        }
    }

    @media screen and (max-width: 1200px) {
        .foot {
            display: none;
        }
    }
</style>

<body>
    <div class="foot">
        <div id="footinfo">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Theme: <a
                href="https://github.com/850552586/gridea-theme-fog">Fog</a>
            <div>
                
                <div id="sitegotimeDate">ËΩΩÂÖ•Â§©Êï∞...</div>
                <div id="sitegotimes">ËΩΩÂÖ•Êó∂ÂàÜÁßí...</div>
                <div id="cussitetime" style="display:none">07/18/2022</div>
                
            </div>
            <div>
                
            </div>
            <div class="copyright" style="color:white;text-align: center;">
            </div>
        </div>



    </div>
</body>

<script>
    //----------------------Á´ôÁÇπËøêË°åÊó∂Èó¥
    var now = new Date();

    function createtime() {
        var sitegotime = document.getElementById("cussitetime").innerHTML + " 00:00:00";
        var grt = new Date(sitegotime); //Ê≠§Â§Ñ‰øÆÊîπ‰Ω†ÁöÑÂª∫Á´ôÊó∂Èó¥ÊàñËÄÖÁΩëÁ´ô‰∏äÁ∫øÊó∂Èó¥ 
        now.setTime(now.getTime() + 250);
        days = (now - grt) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if (String(hnum).length == 1) {
            hnum = "0" + hnum;
        }
        minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if (String(mnum).length == 1) {
            mnum = "0" + mnum;
        }
        seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if (String(snum).length == 1) {
            snum = "0" + snum;
        }
        document.getElementById("sitegotimeDate").innerHTML = "Êú¨Á´ôÂ∑≤ÂÆâÂÖ®ËøêË°å " + dnum + " Â§© ";
        document.getElementById("sitegotimes").innerHTML = hnum + " Â∞èÊó∂ " + mnum + " ÂàÜ " + snum + " Áßí";
    }

    let intervalId = setInterval("createtime()", 250);
</script>

    </div>

    <img class="moon" src="https://2006wzt.github.io/media/images/moon.png" onclick="moonlight()">
    <script src="https://2006wzt.github.io/media/js/wordshow.js"></script>
    
    <!--------------- Â∑¶‰æßËèúÂçïÊ†èüëÜ ------------------------>

    <!----------------- È°∂ÈÉ®ËèúÂçïÊ†èüëá ------------------------>
    
    <!----------------- È°∂ÈÉ®ËèúÂçïÊ†èüëÜ ------------------------>

<!--Ê†∏ÂøÉÂäüËÉΩÂä†ËΩΩ-->
<script src="https://2006wzt.github.io/media/js/mainfunc.js"></script>

<!------------- Fog1.0ÁâàÊú¨ÂΩ©Ëõãüëá -------------->
    <!-- <section id="terrestrial" class="popup">
        <a href="#" class="back">&lt; back</a>
    </section>

    <div class="flycontainer">
        <div class="flyword">Âæ°È£éÈ£ûË°å‰∏≠...</div>
    </div>

    <script>
        $("#fog_go").click(function(){fog_go()});
        async function fog_go(){
            $(".bars").hide()
            $("#live2d").hide()
            await sleep(3000);
            $(".flycontainer").css("display","flex");
            $(".popup").fadeOut(500)
            await sleep(2000);
            var sitename = "My Brain";
            getFogUser(sitename);
        }

        function fog_goregis(){
            var sitename = "My Brain";
            var siteurl = "https://2006wzt.github.io";
            regisFogUser(sitename,siteurl);
        }
        fog_goregis();
    </script> -->
<!------------- Fog1.0ÁâàÊú¨ÂΩ©ËõãüëÜ -------------->
<script>
    function change_topmenu(){
        tmcolor = "antiquewhite"
        tsnamecolor = "antiquewhite"
        $(".navbar-inverse .navbar-nav>li>a").css("color",tmcolor)
        $(".navbar-inverse .navbar-brand").css("color",tsnamecolor)
        $(".navbar-fixed-top").css("border-radius","0 0 10px 10px")
    }
</script>

<!------ Ê†πÊçÆËá™ÂÆö‰πâÈÖçÁΩÆÂ£∞ÊòéÂèòÈáèüëá --------------------->
    
    <script>
        var postnumChoice = false
    </script>
    
    
    <script>
        var shareChoice = true
    </script>
    
    
    <script>
        var donateChoice = false
    </script>
    
    
    <script>
        var searchChoice = true
    </script>
    
    <script>let postsnum = 0;</script>
    <div id="side-posttitle" style="display: none;">
    
    
    SocketÁºñÁ®ãÂÆûÈ™å
    <script>
        postsnum += 1
    </script>
    
    
    
    CSP-Á≤æÁÇº
    <script>
        postsnum += 1
    </script>
    
    
    
    Ê∑±Â∫¶Â≠¶‰π†ÂÆûÊàòÔºà‰∫åÔºâÔºöÁü•ËØÜÂõûÈ°æ
    <script>
        postsnum += 1
    </script>
    
    
    
    Ê∑±Â∫¶Â≠¶‰π†ÂÆûÊàòÔºà‰∏ÄÔºâÔºöÊ∑±Â∫¶Â≠¶‰π†ÂØºËÆ∫
    <script>
        postsnum += 1
    </script>
    
    
    
    ÁÆóÊ≥ïÂà∑È¢òÂ∞èËÆ∞
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂçÅÂõõÔºâÔºöÊ†ëÊ®°Âûã
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂçÅ‰∏âÔºâÔºöÊ†∏ÂáΩÊï∞
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂçÅ‰∫åÔºâÔºöÂèÇÊï∞ÊùÉË°°
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂçÅ‰∏ÄÔºâÔºöÁªèÈ™åÈ£éÈô©ÊúÄÂ∞èÂåñ
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂçÅÔºâÔºöÊîØÊåÅÂêëÈáèÊú∫
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºà‰πùÔºâÔºöÁ∫øÊÄßÂõûÂΩí
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂÖ´ÔºâÔºöÊ¢ØÂ∫¶‰∏ãÈôç
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºà‰∏ÉÔºâÔºöÈÄªËæëÂõûÂΩí
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂÖ≠ÔºâÔºöÊú¥Á¥†Ë¥ùÂè∂ÊñØ
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºà‰∫îÔºâÔºöÊ¶ÇÁéá‰º∞ËÆ°
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºàÂõõÔºâÔºöÊÑüÁü•Êú∫ÁÆóÊ≥ï
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºà‰∏âÔºâÔºöKNNÁÆóÊ≥ï
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºà‰∫åÔºâÔºöÁõëÁù£Â≠¶‰π†
    <script>
        postsnum += 1
    </script>
    
    
    
    Êú∫Âô®Â≠¶‰π†ÂÆûÊàòÔºà‰∏ÄÔºâÔºöÊú∫Âô®Â≠¶‰π†ÂØºËÆ∫
    <script>
        postsnum += 1
    </script>
    
    
    
    PythonÂÖ•Èó®‰∏éÂÆûÊàò
    <script>
        postsnum += 1
    </script>
    
    
    
    
    
    
    </div>
    
        <script>
            var menupos = 'left';
            $("#siteinfo-postsnum").html(postsnum);
        </script>
    
    <script>
        let commentsHide = false
    </script>
    <!------ Ê†πÊçÆËá™ÂÆö‰πâÈÖçÁΩÆÂ£∞ÊòéÂèòÈáèüëÜ --------------------->


    <!----------Ê†πÊçÆËá™ÂÆö‰πâÈÖçÁΩÆËÆæÁΩÆÂõæÊ†á‰ø°ÊÅØüëá---------->
    <script>
        var icondict = new Array();
    </script>
    
        
    
    <!----------Ê†πÊçÆËá™ÂÆö‰πâÈÖçÁΩÆËÆæÁΩÆÂõæÊ†á‰ø°ÊÅØüëÜ---------->
</body>

<script src="https://2006wzt.github.io/media/share/dist/Share.js"></script>
<!-- È°µÈù¢pjaxÊµãËØï -->
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.pjax/2.0.1/jquery.pjax.js"></script>
<!--Á°Æ‰øùjQueryÂ∑≤ÁªèÂú®Ê≠§‰πãÂâçÂä†ËΩΩ-->
<!-- <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script> -->
<script src="https://2006wzt.github.io/media/js/all-pjax.js"></script>
<script>
    //-------------------------------ËØ¥ËØ¥ÂäüËÉΩüëá--------------------------------------
    let talksall = [];
    let talks = [];
    let talkindex = 0;
    get();

    function get() {
        var t = JSON.parse('[]');
        talkindex = t.length - 1;
        for (var i = 0; i <= t.length - 1; i++) {
            var d = {};
            d["time"] = t[i].time;
            d["author"] = t[i].author;
            d["text"] = t[i].text;
            d["img"] = t[i].img;
            talksall.push(d);
        }
    }

    function add() {
        for (var i = talkindex; i >= 0 && i > talkindex - 3; i--) {
            talks.push(talksall[i]);
        }
        talkindex = (talkindex - 3) >= 0 ? (talkindex - 3) : -1;
        if (talkindex < 0) $("#getmorebt").hide();
        show();
    }

    function show() {
        var talkT = document.getElementById("talkContainer");
        talkT.innerHTML = "";
        for (var i = 0; i < talks.length; i++) {
            if (talks[i].img != '') {
                talkT.innerHTML += '\
            <div class="talk" v-for="t in talks"> \
                <span data-fancybox="images" href="' + talks[i].img + '"><img src="' + talks[i].img + '" class="talkimg"></span> \
                <div class="ainfo">\
                    <div class="ainfo-intro">\
                        <div class="author">' + talks[i].author + '</div>¬∑\
                        <div class="time">' + talks[i].time + '</div>\
                    </div>\
                </div>\
                <div class="talkcontent">' + talks[i].text + '\
                </div\>\
            ';
            } else {
                talkT.innerHTML += '\
            <div class="talk" v-for="t in talks"> \
                <div class="ainfo">\
                    <div class="ainfo-intro">\
                        <div class="author">' + talks[i].author + '</div>¬∑\
                        <div class="time">' + talks[i].time + '</div>\
                    </div>\
                </div>\
                <div class="talkcontent">' + talks[i].text + '\
                </div\>\
            ';
            }
        }
    }
    //-------------------------------ËØ¥ËØ¥ÂäüËÉΩüëÜ--------------------------------------
</script>

<!---->
<script>
    function replaceAvatar() {
        twikoo_avatar = $(".tk-avatar-img");
        for (var i = 0; i < twikoo_avatar.length; i++) {
            var asrc = twikoo_avatar.eq(i).attr('src');
            if (asrc.search('cn.gravatar.com') != -1) {
                twikoo_avatar.eq(i).attr('src', 'https://2006wzt.github.io/media/images/comavatar.png');
            }
        }
    }

    function showWechat() {
        var wechat = '';
        alert("Âçö‰∏ªÂæÆ‰ø°Âè∑Ôºö" + wechat);
        return false;
    }
</script>

<script>
    /**
     * https://github.com/tangkaichuan/gridea-search
     */
    // Ê£ÄÊü•ÁºìÂ≠òÊòØÂê¶ÊúÄÊñ∞
    function checkCache() {
        var caches_postsnum = localStorage.getItem("postsnum");
        var pt = document.getElementById("side-posttitle").innerHTML;
        pt = pt.replace(/\s+/g, '').replace(/<script>.*?<\/script>/gi, "")
        var ptlen = pt.length;
        var ptlen_storage = localStorage.getItem("poststitlelen");
        if (caches_postsnum != postsnum || ptlen != ptlen_storage) {
            console.log("Êõ¥Êñ∞ÁºìÂ≠ò");
            return false
        }
        return true;
    }

    (function () {
        var CACHES = checkCache()
        if (!CACHES) {
            var NOW = Date.now()
            var API_CONTENT = '../api-content/index.html' + '?_=' + NOW
            preload(API_CONTENT);
            getContents(show_getContentresult);
        }

        function show_getContentresult(data) {
            console.log("Ëé∑ÂèñÊàêÂäü");
            var postslen = data["posts"].length;
            localStorage.setItem('postsnum', postslen);
            var poststitlelen = 0;
            var pt = document.getElementById("side-posttitle").innerHTML;
            pt = pt.replace(/\s+/g, '').replace(/<script>.*?<\/script>/gi, "");
            localStorage.setItem('poststitlelen', pt.length);
        }



        // preload
        function preload(url) {
            var preloadLink = document.createElement('link')
            preloadLink.href = url
            preloadLink.rel = 'preload'
            preloadLink.as = 'fetch'
            preloadLink.crossOrigin = 'anonymous'
            document.head.appendChild(preloadLink)
        }

        // ÂºÇÊ≠• GET ËØ∑Ê±Ç
        function get(obj) {
            var xhr = new XMLHttpRequest()
            xhr.open('get', obj.url, true)
            xhr.send(null)
            xhr.onreadystatechange = function () {
                // ÂºÇÊ≠•ËØ∑Ê±ÇÔºöÂìçÂ∫îÁä∂ÊÄÅ‰∏∫4ÔºåÊï∞ÊçÆÂä†ËΩΩÂÆåÊØï
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        obj.success(xhr.responseText)
                    } else {
                        obj.error(xhr.status)
                    }
                }
            }
        }

        // Ëé∑ÂèñÂçöÂÆ¢ÂÖ®Êñá api
        function getContents(callback) {
            if (CACHES) {
                callback(CACHES.contents)
            } else {
                get({
                    url: API_CONTENT,
                    success: function (data) {
                        callback(JSON.parse(data));
                        localStorage.setItem('ContentsCache', data);
                        getStorageContent();
                    }
                })
            }
        }
    })()
    //------------------------Ê†∏ÂøÉÂäüËÉΩ--pjaxÂÖ®Â±ÄÊ∏≤Êüìüëá-------------------
    let talkinit = false;
    $(document).pjax('a[data-pjax]', '#main', {
        fragment: '#main',
        timeout: 8000
    }).on('pjax:complete', function () {
        //‰ª£Á†ÅÂùóÈ´ò‰∫ÆÊ∏≤Êüì
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
        //ÊñáÁ´†ÁÉ≠Â∫¶
        if(postnumChoice){
            getHotnum();
        }
        //ÊñáÁ´†Á¥¢Âºï
        toginit();
        //Ê∏ÖÁ©∫ÊêúÁ¥¢Ê†è
        if (searchChoice) {
            searchInit();
            searchInput.value = "";
        }
        var pl = window.location.pathname;
        //ËØ¥ËØ¥Êõ¥Êñ∞
        if (pl.search("talk") != -1 && !talkinit) {
            add();
            talkinit = true;
        } else if (pl.search("talk") != -1) {
            show();
        }
        if (pl.search("post") != -1) {
            if (shareChoice)
                shareInit();
            if (donateChoice)
                donateInit();
            if ("default" == "default"&&!commentsHide) {
                $("#comment").hide()
                commentsHide = true
            }
            lazyload();
            codeinit();
            if ("default" == "twikoo") {
                //twikooÂ§¥ÂÉèÊõ¥Êç¢
                setTimeout(replaceAvatar, 3000);
                setTimeout(replaceAvatar, 8000); //ÈÉ®ÂàÜÂçö‰∏ªÁ´ôÁÇπÈÄüÂ∫¶Âä†ËΩΩËøáÊÖ¢ÔºåÂÜçÊ∑ªÂä†‰∏Ä‰∏™Âª∂Ëøü
            }
        }
        if (btstate == true)
            dropdown();
    }).on('pjax:start', function () {
        $(".pjaxloading").fadeIn(50);
    }).on('pjax:end', function () {
        $(".pjaxloading").fadeOut(50);
    });
    //------------------------Ê†∏ÂøÉÂäüËÉΩ--pjaxÂÖ®Â±ÄÊ∏≤ÊüìüëÜ-------------------

    //-------------------------------------------------ÊêúÁ¥¢
    // Ëé∑ÂèñÊêúÁ¥¢Ê°Ü„ÄÅÊêúÁ¥¢ÊåâÈíÆ„ÄÅÊ∏ÖÁ©∫ÊêúÁ¥¢„ÄÅÁªìÊûúËæìÂá∫ÂØπÂ∫îÁöÑÂÖÉÁ¥†
    if (searchChoice) {
        var searchInput = document.querySelector('.search-input');
        var searchResults = document.querySelector('.search-results');
    }
    // Áî≥Êòé‰øùÂ≠òÊñáÁ´†ÁöÑÊ†áÈ¢ò„ÄÅÈìæÊé•„ÄÅÂÜÖÂÆπÁöÑÊï∞ÁªÑÂèòÈáè
    var searchValue = '',
        arrItems = [],
        arrLinks = [],
        arrTitles = [],
        arrContents = [],
        arrResults = [],
        indexItem = [],
        itemLength = 0;
    var tmpDiv = document.createElement('div');
    tmpDiv.className = 'result-item';


    function getStorageContent() {
        var data = localStorage.getItem('ContentsCache');
        data = JSON.parse(data);
        posts = data["posts"];
        for (var i = 0; i < posts.length; i++) {
            arrLinks[i] = posts[i].link;
            arrTitles[i] = posts[i].title;
            arrContents[i] = posts[i].content;
            itemLength++;
        }
    }
    if (checkCache())
        getStorageContent();
    // ËæìÂÖ•Ê°ÜÂÜÖÂÆπÂèòÂåñÂêéÂ∞±ÂºÄÂßãÂåπÈÖçÔºåÂèØ‰ª•‰∏çÁî®ÁÇπÊåâÈíÆ
    // ÁªèÊµãËØïÔºåonkeydown, onchange Á≠âÊñπÊ≥ïÊïàÊûú‰∏çÂ§™ÁêÜÊÉ≥Ôºå
    // Â≠òÂú®ËæìÂÖ•Âª∂ËøüÁ≠âÈóÆÈ¢òÔºåÊúÄÂêéÂèëÁé∞Ëß¶Âèë input ‰∫ã‰ª∂ÊúÄÁêÜÊÉ≥Ôºå
    // Âπ∂‰∏îÂèØ‰ª•Â§ÑÁêÜ‰∏≠ÊñáËæìÂÖ•Ê≥ïÊãºÂÜôÁöÑÂèòÂåñ
    searchInput.oninput = function () {
        setTimeout(searchConfirm, 0);
    }
    searchInput.onfocus = function () {
        searchResults.style.display = 'block';
    }

    function searchConfirm() {
        if (searchInput.value == '') {
            searchResults.style.display = 'none';
        } else if (searchInput.value.search(/^\s+$/) >= 0) {
            // Ê£ÄÊµãËæìÂÖ•ÂÄºÂÖ®ÊòØÁ©∫ÁôΩÁöÑÊÉÖÂÜµ
            searchInit();
            var itemDiv = tmpDiv.cloneNode(true);
            itemDiv.innerText = 'ËØ∑ËæìÂÖ•ÊúâÊïàÂÜÖÂÆπ...';
            searchResults.appendChild(itemDiv);
        } else {
            // ÂêàÊ≥ïËæìÂÖ•ÂÄºÁöÑÊÉÖÂÜµ
            searchInit();
            searchValue = searchInput.value;
            // Âú®Ê†áÈ¢ò„ÄÅÂÜÖÂÆπ‰∏≠Êü•Êâæ
            searchMatching(arrTitles, arrContents, searchValue);
        }
    }

    // ÊØèÊ¨°ÊêúÁ¥¢ÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
    function searchInit() {
        arrResults = [];
        indexItem = [];
        searchResults.innerHTML = '';
        searchResults.style.display = 'block';
    }

    function searchMatching(arr1, arr2, input) {
        // ÂøΩÁï•ËæìÂÖ•Â§ßÂ∞èÂÜô
        input = new RegExp(input, 'i');
        var step = 10;
        // Âú®ÊâÄÊúâÊñáÁ´†Ê†áÈ¢ò„ÄÅÂÜÖÂÆπ‰∏≠ÂåπÈÖçÊü•ËØ¢ÂÄº
        for (i = 0; i < itemLength; i++) {
            var indexContent = arr2[i].search(input);
            //Ê†áÈ¢òÂåπÈÖç
            if (arr1[i].search(input) != -1) {
                indexItem.push(i); // ‰øùÂ≠òÂåπÈÖçÂÄºÁöÑÁ¥¢Âºï
                if (indexContent != -1) {
                    startindex = (indexContent - step) >= 0 ? (indexContent - step) : 0;
                    var searchcontent = arr2[i].slice(indexContent - step, indexContent + 5)
                    arrResults.push("....." + searchcontent + ".....");
                } else
                    arrResults.push("");
            }
            //ÂÜÖÂÆπÂåπÈÖç
            else if (indexContent != -1) {
                indexItem.push(i); // ‰øùÂ≠òÂåπÈÖçÂÄºÁöÑÁ¥¢Âºï

                startindex = (indexContent - step) >= 0 ? (indexContent - step) : 0;
                var searchcontent = arr2[i].slice(indexContent - step, indexContent + 5)
                arrResults.push("....." + searchcontent + ".....");
            }
        }

        // ËæìÂá∫ÊÄªÂÖ±ÂåπÈÖçÂà∞ÁöÑÊï∞ÁõÆ
        var totalDiv = tmpDiv.cloneNode(true);
        totalDiv.innerHTML = '<b>ÊÄªÂåπÈÖçÔºö' + indexItem.length + ' È°π<hr></b>';
        searchResults.appendChild(totalDiv);

        // Êú™ÂåπÈÖçÂà∞ÂÜÖÂÆπÁöÑÊÉÖÂÜµ
        if (indexItem.length == 0) {
            var itemDiv = tmpDiv.cloneNode(true);
            itemDiv.innerText = 'Êú™ÂåπÈÖçÂà∞ÂÜÖÂÆπ...';
            searchResults.appendChild(itemDiv);
        }

        // Â∞ÜÊâÄÊúâÂåπÈÖçÂÜÖÂÆπËøõË°åÁªÑÂêà
        for (i = 0; i < arrResults.length; i++) {
            var itemDiv = tmpDiv.cloneNode(true);
            itemDiv.innerHTML = '<a data-pjax class="searchresults" href="' + arrLinks[indexItem[i]] + '"><b>[' +
                arrTitles[indexItem[i]] +
                ']</b><p>' + arrResults[i] + '</p></a><hr />';
            searchResults.appendChild(itemDiv);
        }
    }
</script>



<!--------------------- ËèúÂçïÊ†èÂõæÊ†áÂä†ËΩΩÂäüËÉΩüëá ----------------------->
<script>
var menulist = $(".menuicon");
var menulength = menulist.length;
for (var i = 0; i < menulength; i++) {
    var altname = menulist.eq(i).attr("alt");
    var iconurl = icondict[altname];
    if (iconurl == undefined || iconurl == '')
        continue;
    if (iconurl == 'Home') {
        menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/Home.png");
menulist.eq(i).show();
} else if (iconurl == 'Archive') {
menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/Archive.png");
menulist.eq(i).show();
} else if (iconurl == 'Tag') {
menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/Tag.png");
menulist.eq(i).show();
} else if (iconurl == 'About') {
menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/About.png");
menulist.eq(i).show();
} else if (iconurl == 'Talk') {
menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/Talk.png");
menulist.eq(i).show();
} else if (iconurl == 'Friends') {
menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/Friends.png");
menulist.eq(i).show();
} else if (iconurl == 'Fly') {
menulist.eq(i).attr("src", "https://2006wzt.github.io/media/images/wind.png");
menulist.eq(i).show();
} else {
menulist.eq(i).attr("src", iconurl);
menulist.eq(i).show();
}
}
</script>
<!--------------------- ËèúÂçïÊ†èÂõæÊ†áÂä†ËΩΩÂäüËÉΩüëÜ ----------------------->

<script>
    //--------------------bber-onetalkÂä†ËΩΩüëá--------------------------------
    function bberonetalkLoad(){
        bberjsonurl = '';
        if ( $("#bber-talk").length > 0 ) {
        jsonUrl = bberjsonurl
        $.getJSON(jsonUrl+"?t="+Date.parse( new Date()),function(res){
        var bberHtml = ''
        $.each(res.data, function(i, item){
            d = new Date(item.date)
            date = d.getFullYear()+'/'+(d.getMonth()+1)+'/'+d.getDate() +' '+d.getHours()+':'+d.getMinutes()+':'+d.getSeconds()
            dataTime = '<span class="datatime">'+date+'</span>'
            bberHtml += '<li class="item item-'+(i+1)+'">'+dataTime+'Ôºö <a data-pjax href="https://2006wzt.github.io/bber">'+item.content+'</a></li>'
        });
        $('#bber-talk').append('<span class="index-talk-icon"><svg viewBox="0 0 1024 1024" width="21" height="21"><path d="M184.32 891.667692c-12.603077 0-25.206154-2.363077-37.809231-7.876923-37.021538-14.966154-59.864615-49.624615-59.864615-89.009231v-275.692307c0-212.676923 173.292308-385.969231 385.969231-385.969231h78.76923c212.676923 0 385.969231 173.292308 385.969231 385.969231 0 169.353846-137.846154 307.2-307.2 307.2H289.083077l-37.021539 37.021538c-18.904615 18.116923-43.323077 28.356923-67.741538 28.356923zM472.615385 195.347692c-178.018462 0-322.953846 144.935385-322.953847 322.953846v275.692308c0 21.267692 15.753846 29.144615 20.48 31.507692 4.726154 2.363077 22.055385 7.876923 37.021539-7.08923l46.473846-46.473846c6.301538-6.301538 14.178462-9.452308 22.055385-9.452308h354.461538c134.695385 0 244.184615-109.489231 244.184616-244.184616 0-178.018462-144.935385-322.953846-322.953847-322.953846H472.615385z"></path><path d="M321.378462 512m-59.076924 0a59.076923 59.076923 0 1 0 118.153847 0 59.076923 59.076923 0 1 0-118.153847 0Z"></path><path d="M518.301538 512m-59.076923 0a59.076923 59.076923 0 1 0 118.153847 0 59.076923 59.076923 0 1 0-118.153847 0Z"></path><path d="M715.224615 512m-59.076923 0a59.076923 59.076923 0 1 0 118.153846 0 59.076923 59.076923 0 1 0-118.153846 0Z"></path></svg></span><ul class="talk-list">'+bberHtml+'</ul>')
        //Lately({ 'target': '#bber-talk .datatime' });
        });
        function Roll (){
        var list_li = $('.talk-list li'),cur_li = list_li.first(),last_li = list_li.last();
        last_li.after(cur_li);
        };
        setInterval(Roll,3000);
    }
    }
  //--------------------bber-onetalkÂä†ËΩΩüëÜ--------------------------------
</script>

<script>
    var ClicksideState = 1
    var cur_readingmode = false
    function readingmode(){
        if (!cur_readingmode){
            if(menupos == 'left'){
                if(ClicksideState==1)
                menu_openclose1()
            }
            $("#tab1").fadeOut(50)
            $("#bg").fadeOut(50)
            $(".navbar").fadeOut(50)
            $(".markdownIt-TOC li a").css("color","black")
            cur_readingmode = true
        }else{
            if(menupos == 'left'){
                if(ClicksideState==0)
                    menu_openclose1()
            }
            $("#tab1").fadeIn(50)
            $("#bg").fadeIn(50)
            $(".navbar").fadeIn(50)
            $(".markdownIt-TOC li a").css("color","antiquewhite")
            cur_readingmode = false  
        }
    }
</script>


<!----Â§úÈó¥Ê®°Âºèüëá-->
<script>
    var moonlightState = false
    function moonlight(){
        if(!moonlightState){
            $("#bg").fadeOut(200)
            $('body').css("background","rgba(0,0,0,0.8)")
            $(".markdownIt-TOC li a").css("color","white")
            $(".text p, .text ul").css("color","white")
            $("#articlecontent").css("color","white")
            $(".post-copyright").css("background","rgba(10,10,10,0.5)")
            $('blockquote').css("background","rgba(10,10,10,0.6)")
            $("#articlecontent").css("background","rgba(10,10,10,0.5)")
            moonlightState = true
            $(".moon").attr("src","https://2006wzt.github.io/media/images/sun.png")
        }else{
            $("#bg").show()
            $(".markdownIt-TOC li a").css("color","antiquewhite")
            $(".text p, .text ul").css("color","rgba(0, 0, 0, 0.7)")
            $("#articlecontent").css("color","black")
            $(".post-copyright").css("background","#f9f9f9")
            $('blockquote').css("background","#eff8f0")
            $("#articlecontent").css("background","white")
            $(".moon").attr("src","https://2006wzt.github.io/media/images/moon.png")
            $('body').css("background","white")
            moonlightState = false
        }
    }
</script>
<!----Â§úÈó¥Ê®°ÂºèüëÜ--></div>
            <!--------------- pcÁ´ØËèúÂçïÊ†èüëÜ ---------------->

            <!-- ----------------Â∑¶‰æßËèúÂçïÊ†èhtml üëá-------------------------------------->
            
            <div>
                <div id="tab1" class="tab">
                    <div class="bars">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="close"></div>
                </div>
                <div class="col-md-1 col-lg-3"></div>
                <!-- mainÊ†áÁ≠æÔºåpjaxÊ∏≤ÊüìÊó∂Âä†ËΩΩ‰ª•‰∏ãÂÜÖÂÆπüëá -->
                <div id="main" class="col-xs-12 col-sm-12 col-md-12 col-lg-7" style="padding:0;">
                    <div class="readingmode" onclick="readingmode()">ÈòÖ</div>
                    <link rel="stylesheet" href="https://2006wzt.github.io/media/css/font-awesome.css">

<body>
    <div class="allcontent" id="postdetail">
        <div class="postshow postpadding" style="padding-bottom: 0;">
            
            <div class="postdetailimg">
                <img src="https://2006wzt.github.io/post-images/socketÁºñÁ®ãÂÆûÈ™å.png" class="postimage" style="cursor:auto">
            </div>
            <div class="postinfo-detail">
                <div class="postdate"><i class="fa fa-calendar"></i>2022-11-05</div>
                <div class="poststatus postdate"><i class="fa fa-clock-o"></i> 69 min read</div>
                <div class="posttag">
                    
                    <a data-pjax href="https://2006wzt.github.io/tag/ebXlXX0IT/" class="postlink">
                        <i class="fa fa-tag"></i> C/C++
                    </a>
                    
                </div>
            </div>
            
        <div id="articlecontent">
            <div id="texttitle" style="text-align: center">
                <h2 id="ptitle">SocketÁºñÁ®ãÂÆûÈ™å</h2>
                <!-- id Â∞Ü‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂ -->
                <div id="pl" style="display:none">https://2006wzt.github.io/post/socketÁºñÁ®ãÂÆûÈ™å/</div>
                <div id="rootaddr" style="display:none">https://2006wzt.github.io</div>
                
            </div>
            <div class="text ">
                <h1 id="socketÁºñÁ®ãÂÆûÈ™å">SocketÁºñÁ®ãÂÆûÈ™å</h1>
<h2 id="‰∏Ä-ÂÆûÈ™åË¶ÅÊ±Ç">‰∏Ä„ÄÅÂÆûÈ™åË¶ÅÊ±Ç</h2>
<h3 id="11-ÂÆûÈ™åÁõÆÊ†áÂíåÂÜÖÂÆπ">1.1 ÂÆûÈ™åÁõÆÊ†áÂíåÂÜÖÂÆπ</h3>
<h4 id="111-ÂÆûÈ™åÁõÆÁöÑ">1.1.1 ÂÆûÈ™åÁõÆÁöÑ</h4>
<p>‚óè ‰∫ÜËß£Â∫îÁî®Â±ÇÂíåËøêËæìÂ±ÇÁöÑ‰ΩúÁî®ÂèäÁõ∏ÂÖ≥ÂçèËÆÆÁöÑÂ∑•‰ΩúÂéüÁêÜÂíåÊú∫Âà∂„ÄÇ<br>
‚óè ÊéåÊè° SOCKET ÁºñÁ®ãÁöÑÂü∫Êú¨ÊñπÊ≥ï„ÄÇ</p>
<h4 id="112-ÂÆûÈ™åÁéØÂ¢É">1.1.2 ÂÆûÈ™åÁéØÂ¢É</h4>
<p>‚óè Êìç‰ΩúÁ≥ªÁªüÔºöWindows<br>
‚óè ËØ≠Ë®ÄÔºöC++<br>
‚óè ÁºñÁ®ãÂºÄÂèëÁéØÂ¢ÉÔºöVisual Studio 2008-2019 ÁöÜÂèØ</p>
<h4 id="113-ÂÆûÈ™åÂÜÖÂÆπ">1.1.3 ÂÆûÈ™åÂÜÖÂÆπ</h4>
<p>**È¢òÁõÆÔºö**ÁºñÂÜô‰∏Ä‰∏™ Web ÊúçÂä°Âô®ËΩØ‰ª∂ÔºåË¶ÅÊ±ÇÂ¶Ç‰∏ãÔºö</p>
<p><strong>Âü∫Êú¨Ë¶ÅÊ±ÇÔºö</strong><br>
‚óè ÂèØÈÖçÁΩÆ Web ÊúçÂä°Âô®ÁöÑÁõëÂê¨Âú∞ÂùÄ„ÄÅÁõëÂê¨Á´ØÂè£Âíå‰∏ªÁõÆÂΩïÔºà‰∏çÂæóÂÜôÂú®‰ª£Á†ÅÈáåÈù¢Ôºå‰∏çËÉΩÊØèÈÖçÁΩÆ‰∏ÄÊ¨°ÈÉΩË¶ÅÈáçÁºñËØë‰ª£Á†ÅÔºâÔºõ<br>
‚óè ËÉΩÂ§üÂçïÁ∫øÁ®ãÂ§ÑÁêÜ‰∏Ä‰∏™ËØ∑Ê±Ç„ÄÇÂΩì‰∏Ä‰∏™ÂÆ¢Êà∑ÔºàÊµèËßàÂô®,ËæìÂÖ• URLÔºöhttp://202.103.2.3/index.htmlÔºâËøûÊé•Êó∂ÂàõÂª∫‰∏Ä‰∏™ËøûÊé•Â•óÊé•Â≠óÔºõ<br>
‚óè ‰ªéËøûÊé•Â•óÊé•Â≠óÊé•Êî∂ http ËØ∑Ê±ÇÊä•ÊñáÔºåÂπ∂Ê†πÊçÆËØ∑Ê±ÇÊä•ÊñáÁöÑÁ°ÆÂÆöÁî®Êà∑ËØ∑Ê±ÇÁöÑÁΩëÈ°µÊñá‰ª∂Ôºõ<br>
‚óè ‰ªéÊúçÂä°Âô®ÁöÑÊñá‰ª∂Á≥ªÁªüËé∑ÂæóËØ∑Ê±ÇÁöÑÊñá‰ª∂„ÄÇ ÂàõÂª∫‰∏Ä‰∏™Áî±ËØ∑Ê±ÇÁöÑÊñá‰ª∂ÁªÑÊàêÁöÑ http ÂìçÂ∫îÊä•Êñá„ÄÇÔºõ<br>
‚óè Áªè TCP ËøûÊé•ÂêëËØ∑Ê±ÇÁöÑÊµèËßàÂô®ÂèëÈÄÅÂìçÂ∫îÔºåÊµèËßàÂô®ÂèØ‰ª•Ê≠£Á°ÆÊòæÁ§∫ÁΩëÈ°µÁöÑÂÜÖÂÆπÔºõ</p>
<p><strong>È´òÁ∫ßË¶ÅÊ±ÇÔºö</strong><br>
‚óè ËÉΩÂ§ü‰º†ËæìÂåÖÂê´Â§öÂ™í‰ΩìÔºàÂ¶ÇÂõæÁâáÔºâÁöÑÁΩëÈ°µÁªôÂÆ¢Êà∑Á´ØÔºåÂπ∂ËÉΩÂú®ÂÆ¢Êà∑Á´ØÊ≠£Á°ÆÊòæÁ§∫Ôºõ<br>
‚óè Âú®ÊúçÂä°Âô®Á´ØÁöÑÂ±èÂπï‰∏äËæìÂá∫ËØ∑Ê±ÇÁöÑÊù•Ê∫êÔºàIP Âú∞ÂùÄ„ÄÅÁ´ØÂè£Âè∑Âíå HTTP ËØ∑Ê±ÇÂëΩ‰ª§Ë°åÔºâÔºõ<br>
‚óè Âú®ÊúçÂä°Âô®Á´ØÁöÑÂ±èÂπï‰∏äËÉΩÂ§üËæìÂá∫ÂØπÊØè‰∏Ä‰∏™ËØ∑Ê±ÇÂ§ÑÁêÜÁöÑÁªìÊûúÔºõ<br>
‚óè ÂØπ‰∫éÊó†Ê≥ïÊàêÂäüÂÆö‰ΩçÊñá‰ª∂ÁöÑËØ∑Ê±ÇÔºåÊ†πÊçÆÈîôËØØÂéüÂõ†Ôºå‰ΩúÁõ∏Â∫îÈîôËØØÊèêÁ§∫ÔºåÂπ∂ÂÖ∑Â§á‰∏ÄÂÆöÁöÑÂºÇÂ∏∏ÊÉÖÂÜµÂ§ÑÁêÜËÉΩÂäõ„ÄÇ</p>
<h3 id="12-Ê£ÄÊü•Ë°®">1.2 Ê£ÄÊü•Ë°®</h3>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/20221025201531.png" style="zoom:67%;" />
<h2 id="‰∫å-ÂäüËÉΩÂÆûÁé∞">‰∫å„ÄÅÂäüËÉΩÂÆûÁé∞</h2>
<h3 id="21-serverÂíåclientÁÆÄÂçïdemo">2.1 ServerÂíåClientÁÆÄÂçïDemo</h3>
<img src="https://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/20221025202916.png" style="zoom:65%;" />
<h4 id="211-server">2.1.1 Server</h4>
<pre><code class="language-c++">#pragma once
#include &quot;winsock2.h&quot;
#include &lt;stdio.h&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;list&gt;
using namespace std;

#pragma comment(lib,&quot;ws2_32.lib&quot;)

//ÂΩìchromeÊµèËßàÂô®ÊâìÂºÄ‰∏Ä‰∏™ÁΩëÈ°µÊó∂ÔºåÈô§‰∫ÜËØ∑Ê±ÇÁΩëÈ°µÊú¨Ë∫´Â§ñÔºåËøò‰ºöÂèëÂá∫Âè¶Â§ñ‰∏Ä‰∏™ËØ∑Ê±Ç /favicon.icoÔºåËØ∑Ê±ÇË∞∑Ê≠åÊµèËßàÂô®ÁöÑÂõæÊ†á
//Âõ†Ê≠§ServerÂÆûÈôÖ‰∏äÊâìÂºÄ‰∫ÜÂ§ö‰∏™‰ºöËØùSocketÔºåÈúÄË¶Å‰∏Ä‰∏™ListÊù•‰øùÂ≠òËøô‰∫õ‰ºöËØùSocket
//‰øùÂ≠òÊâìÂºÄÁöÑÂΩìÂâçÁöÑ‰ºöËØùsocket

list&lt;SOCKET&gt; sessionSockets;

void main(){
	WSADATA wsaData;//ÊèèËø∞‰∫ÜÂÖ≥‰∫é Windows Sockects Â∫ïÂ±ÇÂÆûÁé∞ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ
	fd_set rfds;//Áî®‰∫éÊ£ÄÊü•socketÊòØÂê¶ÊúâÊï∞ÊçÆÂà∞Êù•ÁöÑÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÁî®‰∫ésocketÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÁ≠âÂæÖÁΩëÁªú‰∫ã‰ª∂ÈÄöÁü•ÔºàÊúâÊï∞ÊçÆÂà∞Êù•Ôºâ
	fd_set wfds;//Áî®‰∫éÊ£ÄÊü•socketÊòØÂê¶ÂèØ‰ª•ÂèëÈÄÅÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÁî®‰∫ésocketÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÁ≠âÂæÖÁΩëÁªú‰∫ã‰ª∂ÈÄöÁü•ÔºàÂèØ‰ª•ÂèëÈÄÅÊï∞ÊçÆÔºâ

	/* Â∫ïÂ±ÇÂàùÂßãÂåñ */
	int nRc = WSAStartup(0x0202, &amp;wsaData);//ÂàùÂßãÂåñ
	if (nRc) {//ÂàùÂßãÂåñÂ§±Ë¥•
		printf(&quot;Winsock  startup failed with error!\n&quot;);
	}
	if (wsaData.wVersion != 0x0202) {//ÁâàÊú¨Âè∑ÈîôËØØ
		printf(&quot;Winsock version is not correct!\n&quot;);
	}
	printf(&quot;Winsock  startup Ok!\n&quot;);

	/* SocketÂàùÂßãÂåñ */
	//Áî®Âà∞ÁöÑÂèòÈáèÔºöÁõëÂê¨Socket„ÄÅ‰ºöËØùSocket„ÄÅÊúçÂä°Âô®Âú∞ÂùÄ„ÄÅÂÆ¢Êà∑Á´ØÂú∞ÂùÄ„ÄÅIPÂú∞ÂùÄÈïøÂ∫¶
	SOCKET srvSocket;//ÁõëÂê¨socket	
	sockaddr_in addr, clientAddr;//ÊúçÂä°Âô®Âú∞ÂùÄÂíåÂÆ¢Êà∑Á´ØÂú∞ÂùÄ
	SOCKET sessionSocket;//‰ºöËØùsocketÔºåË¥üË¥£ÂíåclientËøõÁ®ãÈÄö‰ø°
	int addrLen;//ipÂú∞ÂùÄÈïøÂ∫¶
	//ÂàõÂª∫ÁõëÂê¨Socket
	srvSocket = socket(AF_INET, SOCK_STREAM, 0);
	if (srvSocket != INVALID_SOCKET)
		printf(&quot;Socket create Ok!\n&quot;);
	//ËÆæÁΩÆÊúçÂä°Âô®ÁöÑÁ´ØÂè£ÂíåÂú∞ÂùÄ
	addr.sin_family = AF_INET;
	addr.sin_port = htons(5050);
	addr.sin_addr.S_un.S_addr = htonl(INADDR_ANY); //‰∏ªÊú∫‰∏ä‰ªªÊÑè‰∏ÄÂùóÁΩëÂç°ÁöÑIPÂú∞ÂùÄ
	//Â∞ÜÁõëÂê¨Socket‰∏é‰∏ªÊú∫Âú∞ÂùÄÁªëÂÆö
	int rtn = bind(srvSocket, (LPSOCKADDR)&amp;addr, sizeof(addr));
	if (rtn != SOCKET_ERROR)
		printf(&quot;Socket bind Ok!\n&quot;);

	/* ÁõëÂê¨ */
	rtn = listen(srvSocket, 5);
	if (rtn != SOCKET_ERROR)
		printf(&quot;Socket listen Ok!\n&quot;);
	clientAddr.sin_family = AF_INET;
	addrLen = sizeof(clientAddr);

	/* ËÆæÁΩÆÊé•Êî∂ÁºìÂÜ≤Âå∫ */
	char recvBuf[4096];
	u_long blockMode = 1;//Â∞ÜsrvSockËÆæ‰∏∫ÈùûÈòªÂ°ûÊ®°Âºè‰ª•ÁõëÂê¨ÂÆ¢Êà∑ËøûÊé•ËØ∑Ê±Ç
	//Ë∞ÉÁî®ioctlsocketÔºåÂ∞ÜsrvSocketÊîπ‰∏∫ÈùûÈòªÂ°ûÊ®°ÂºèÔºåÊîπÊàêÂèçÂ§çÊ£ÄÊü•fd_setÂÖÉÁ¥†ÁöÑÁä∂ÊÄÅÔºåÁúãÊØè‰∏™ÂÖÉÁ¥†ÂØπÂ∫îÁöÑÂè•ÊüÑÊòØÂê¶ÂèØËØªÊàñÂèØÂÜô
	if ((rtn = ioctlsocket(srvSocket, FIONBIO, &amp;blockMode) == SOCKET_ERROR)) {
		//FIONBIOÔºöÂÖÅËÆ∏ÊàñÁ¶ÅÊ≠¢Â•óÊé•Âè£sÁöÑÈùûÈòªÂ°ûÊ®°Âºè
		cout &lt;&lt; &quot;ioctlsocket() failed with error!\n&quot;;
		return;
	}
	cout &lt;&lt; &quot;ioctlsocket() for server socket ok!	Waiting for client connection and data\n&quot;;

	/* ÁõëÂê¨ClientÊï∞ÊçÆ */
	while (true) {
		//Ê∏ÖÁ©∫rfdsÂíåwfdsÊï∞ÁªÑ
		FD_ZERO(&amp;rfds);
		FD_ZERO(&amp;wfds);

		//Â∞ÜsrvSocketÂä†ÂÖ•rfdsÊï∞ÁªÑ
		//Âç≥ÔºöÂΩìÂÆ¢Êà∑Á´ØËøûÊé•ËØ∑Ê±ÇÂà∞Êù•Êó∂ÔºårfdsÊï∞ÁªÑÈáåsrvSocketÂØπÂ∫îÁöÑÁöÑÁä∂ÊÄÅ‰∏∫ÂèØËØª
		//Âõ†Ê≠§ËøôÊù°ËØ≠Âè•ÁöÑ‰ΩúÁî®Â∞±ÊòØÔºöËÆæÁΩÆÁ≠âÂæÖÂÆ¢Êà∑ËøûÊé•ËØ∑Ê±Ç
		FD_SET(srvSocket, &amp;rfds);



		for (list&lt;SOCKET&gt;::iterator itor = sessionSockets.begin(); itor != sessionSockets.end(); itor++) {
			//Â∞ÜsessionSocketsÈáåÁöÑÊØè‰∏™‰ºöËØùsocketÂä†ÂÖ•rfdsÊï∞ÁªÑÂíåwfdsÊï∞ÁªÑ
			//Âç≥ÔºöÂΩìÂÆ¢Êà∑Á´ØÂèëÈÄÅÊï∞ÊçÆËøáÊù•Êó∂ÔºårfdsÊï∞ÁªÑÈáåsessionSocketÁöÑÂØπÂ∫îÁöÑÁä∂ÊÄÅ‰∏∫ÂèØËØªÔºõ
			//ÂΩìÂèØ‰ª•ÂèëÈÄÅÊï∞ÊçÆÂà∞ÂÆ¢Êà∑Á´ØÊó∂ÔºåwfdsÊï∞ÁªÑÈáåsessionSocketÁöÑÂØπÂ∫îÁöÑÁä∂ÊÄÅ‰∏∫ÂèØÂÜô
			//Âõ†Ê≠§‰∏ãÈù¢‰∫åÊù°ËØ≠Âè•ÁöÑ‰ΩúÁî®Â∞±ÊòØÔºö
			//ËÆæÁΩÆÁ≠âÂæÖÊâÄÊúâ‰ºöËØùSOKCETÂèØÊé•ÂèóÊï∞ÊçÆÊàñÂèØÂèëÈÄÅÊï∞ÊçÆ
			FD_SET(*itor, &amp;rfds);
			FD_SET(*itor, &amp;wfds);
		}

		/*
			selectÂ∑•‰ΩúÂéüÁêÜÔºö‰º†ÂÖ•Ë¶ÅÁõëÂê¨ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÈõÜÂêàÔºàÂèØËØª„ÄÅÂèØÂÜôÔºåÊúâÂºÇÂ∏∏ÔºâÂºÄÂßãÁõëÂê¨ÔºåselectÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ
			ÂΩìÊúâÂèØËØªÂÜô‰∫ã‰ª∂ÂèëÁîüÊàñËÆæÁΩÆÁöÑÁ≠âÂæÖÊó∂Èó¥timeoutÂà∞‰∫ÜÂ∞±‰ºöËøîÂõû
			ËøîÂõû‰πãÂâçËá™Âä®ÂéªÈô§ÈõÜÂêà‰∏≠Êó†‰∫ã‰ª∂ÂèëÁîüÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåËøîÂõûÊó∂‰º†Âá∫Êúâ‰∫ã‰ª∂ÂèëÁîüÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÈõÜÂêà„ÄÇ
			‰ΩÜselect‰º†Âá∫ÁöÑÈõÜÂêàÂπ∂Ê≤°ÊúâÂëäËØâÁî®Êà∑ÈõÜÂêà‰∏≠ÂåÖÊã¨Âì™Âá†‰∏™Â∞±Áª™ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Ôºå
			ÈúÄË¶ÅÁî®Êà∑ÂêéÁª≠ËøõË°åÈÅçÂéÜÊìç‰Ωú(ÈÄöËøáFD_ISSETÊ£ÄÊü•ÊØè‰∏™Âè•ÊüÑÁöÑÁä∂ÊÄÅ)„ÄÇ
		*/
		//ÂºÄÂßãÁ≠âÂæÖÔºåÁ≠âÂæÖrfdsÈáåÊòØÂê¶ÊúâËæìÂÖ•‰∫ã‰ª∂ÔºåwfdsÈáåÊòØÂê¶ÊúâÂèØÂÜô‰∫ã‰ª∂
		/*
			The select function returns the total number of socket handles
			that are ready and contained in the fd_set structure
		*/
		//ËøîÂõûÊÄªÂÖ±ÂèØ‰ª•ËØªÊàñÂÜôÁöÑÂè•ÊüÑ‰∏™Êï∞
		int nTotal = select(0, &amp;rfds, &amp;wfds, NULL, NULL);
		//Â¶ÇÊûúsrvSockÊî∂Âà∞ËøûÊé•ËØ∑Ê±ÇÔºåÊé•ÂèóÂÆ¢Êà∑ËøûÊé•ËØ∑Ê±Ç
		if (FD_ISSET(srvSocket, &amp;rfds)) {
			nTotal--;
			//Âõ†‰∏∫ÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÂà∞Êù•‰πüÁÆóÂèØËØª‰∫ã‰ª∂ÔºåÂõ†Ê≠§-1ÔºåÂâ©‰∏ãÁöÑÂ∞±ÊòØÁúüÊ≠£ÊúâÂèØËØª‰∫ã‰ª∂ÁöÑÂè•ÊüÑ‰∏™Êï∞ÔºàÂç≥ÊúâÂ§öÂ∞ë‰∏™socketÊî∂Âà∞‰∫ÜÊï∞ÊçÆÔºâ
			//‰∫ßÁîü‰ºöËØùSOCKET
			sessionSocket = accept(srvSocket, (LPSOCKADDR)&amp;clientAddr, &amp;addrLen);
			if (sessionSocket != INVALID_SOCKET)
				printf(&quot;Socket listen one client request!\n&quot;);
			//Êää‰ºöËØùSOCKETËÆæ‰∏∫ÈùûÈòªÂ°ûÊ®°Âºè
			if ((rtn = ioctlsocket(sessionSocket, FIONBIO, &amp;blockMode) == SOCKET_ERROR)) {
				//FIONBIOÔºöÂÖÅËÆ∏ÊàñÁ¶ÅÊ≠¢Â•óÊé•Âè£sÁöÑÈùûÈòªÂ°ûÊ®°Âºè„ÄÇ
				cout &lt;&lt; &quot;ioctlsocket() failed with error!\n&quot;;
				return;
			}
			cout &lt;&lt; &quot;ioctlsocket() for session socket ok!	Waiting for client connection and data\n&quot;;
			//ËÆæÁΩÆÁ≠âÂæÖ‰ºöËØùSOKCETÂèØÊé•ÂèóÊï∞ÊçÆÊàñÂèØÂèëÈÄÅÊï∞ÊçÆ
			FD_SET(sessionSocket, &amp;rfds);
			FD_SET(sessionSocket, &amp;wfds);

			//ÊääÊñ∞ÁöÑ‰ºöËØùsocketÂä†ÂÖ•‰ºöËØùsocketÂàóË°®
			sessionSockets.push_back(sessionSocket);
		}

		//Ê£ÄÊü•‰ºöËØùSOCKETÊòØÂê¶ÊúâÊï∞ÊçÆÂà∞Êù•
		if (nTotal &gt; 0) { //Â¶ÇÊûúËøòÊúâÂèØËØª‰∫ã‰ª∂ÔºåËØ¥ÊòéÊòØ‰ºöËØùsocketÊúâÊï∞ÊçÆÂà∞Êù•
			//ÈÅçÂéÜÊâÄÊúâ‰ºöËØùsocketÔºåÂ¶ÇÊûú‰ºöËØùsocketÊúâÊï∞ÊçÆÂà∞Êù•ÔºåÂàôÊé•ÂèóÂÆ¢Êà∑ÁöÑÊï∞ÊçÆ
			for (list&lt;SOCKET&gt;::iterator itor = sessionSockets.begin(); itor != sessionSockets.end(); itor++) {
				if (FD_ISSET(*itor, &amp;rfds)) { //Â¶ÇÊûúÈÅçÂéÜÂà∞ÁöÑÂΩìÂâçsocketÊúâÊï∞ÊçÆÂà∞Êù•
					//receiving data from client
					memset(recvBuf, '\0', 4096);
					rtn = recv(*itor, recvBuf, 4096, 0);
					if (rtn &gt; 0) {
						printf(&quot;Received %d bytes from client: \n%s\n&quot;, rtn, recvBuf);
						//Êñ∞Â¢ûÂä†ÁöÑÔºö2022-10-26
						//ÂêëÊúçÂä°Âô®ÂèëÈÄÅÂìçÂ∫î
						if (FD_ISSET(*itor, &amp;wfds)) {//ÈÅçÂ¶ÇÊûúÂéÜÂà∞ÁöÑÂΩìÂâçsocketÂèØÂèëÈÄÅÊï∞ÊçÆ
							//ÊûÑÂª∫ÂìçÂ∫îÊä•Êñá
							std::string content = &quot;Welcome to VerySimpleServer&quot;;
							std::string resp;
							resp.append(&quot;HTTP/1.1 200 OK\r\n&quot;);
							resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
							resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
							resp.append(&quot;Content-Length: &quot;).append(std::to_string(content.length())).append(&quot;\r\n&quot;);
							resp.append(&quot;\r\n&quot;);
							resp.append(content);
							rtn = send(*itor, resp.c_str(), resp.length(), 0);
							if (rtn &gt; 0) {
								printf(&quot;Send %d bytes to client: %s\n&quot;, rtn, resp.c_str());
							}
						}
					}
				}
			}
		}
	}
}
</code></pre>
<p>‰∏äËø∞Êê≠Âª∫ÁöÑÊúçÂä°Âô®ÊîØÊåÅÁΩëÈ°µÁöÑËÆøÈóÆËØ∑Ê±ÇÔºåËÆøÈóÆÁΩëÂùÄ http://127.0.0.1Ôºå‰ºöÂêëËØ•ÊúçÂä°Âô®ËØ∑Ê±ÇÁΩëÈ°µËµÑÊ∫êÔºåÁÑ∂ÂêéËØ•ÊúçÂä°Âô®‰ºöÂèëÈÄÅÂìçÂ∫îÊä•ÊñáÔºåÂêëÊµèËßàÂô®Êé®ÈÄÅÁΩëÈ°µÔºå‰ΩøÁî®IPÂú∞ÂùÄ127.0.0.1ÊòØÂõ†‰∏∫ËØ•IPÂú∞ÂùÄÊåáÂêëÁöÑÊòØÊú¨‰∏ªÊú∫ÔºåËÄå‰∏ç‰ºöÂèÇ‰∏éÂà∞ÂÖ¨ÂÖ±ÁΩëÁªúÁöÑËÆøÈóÆ‰∏≠Âéª„ÄÇ</p>
<h4 id="212-client">2.1.2 Client</h4>
<pre><code class="language-c++">#pragma once
#include &quot;winsock2.h&quot;
#include &lt;Ws2tcpip.h&gt;
#include &lt;stdio.h&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
using namespace std;
#pragma comment(lib,&quot;ws2_32.lib&quot;)

void main() {
	/* Â∫ïÂ±ÇÂàùÂßãÂåñ */
	WSADATA wsaData;
	string input;
	int nRc = WSAStartup(0x0202, &amp;wsaData);
	if (nRc) {
		printf(&quot;Winsock  startup failed with error!\n&quot;);
	}
	if (wsaData.wVersion != 0x0202) {
		printf(&quot;Winsock version is not correct!\n&quot;);
	}
	printf(&quot;Winsock  startup Ok!\n&quot;);

	/* ClientÁöÑSocketÂàùÂßãÂåñ */
	SOCKET clientSocket;
	sockaddr_in serverAddr, clientAddr;
	int addrLen;
	//create socket
	clientSocket = socket(AF_INET, SOCK_STREAM, 0);
	if (clientSocket != INVALID_SOCKET)
		printf(&quot;Socket create Ok!\n&quot;);
	//set client port and ip
	clientAddr.sin_family = AF_INET;
	clientAddr.sin_port = htons(0);
	clientAddr.sin_addr.S_un.S_addr = htonl(INADDR_ANY);
	//binding
	int rtn = bind(clientSocket, (LPSOCKADDR)&amp;clientAddr, sizeof(clientAddr));
	if (rtn != SOCKET_ERROR)
		printf(&quot;Socket bind Ok!\n&quot;);

	/* ServerÁöÑSocketÂàùÂßãÂåñ */
	//set server's ip and port
	serverAddr.sin_family = AF_INET;
	serverAddr.sin_port = htons(5050);
	inet_pton(AF_INET, &quot;127.0.0.1&quot;, &amp;serverAddr.sin_addr.s_addr);
	rtn = connect(clientSocket, (LPSOCKADDR)&amp;serverAddr, sizeof(serverAddr));
	if (rtn == SOCKET_ERROR)
		printf(&quot;Connect to server error!\n&quot;);
	printf(&quot;Connect to server ok!&quot;);

	do {
		cout &lt;&lt; &quot;\nPlease input your message:&quot;;
		cin &gt;&gt; input;
		//send data to server
		rtn = send(clientSocket, input.c_str(), input.length(), 0);
		if (rtn == SOCKET_ERROR) {
			printf(&quot;Send to server failed\n&quot;);
			closesocket(clientSocket);
			WSACleanup();
			return;
		}
	} while (input != &quot;quit&quot;);
	closesocket(clientSocket);
	WSACleanup();
}
</code></pre>
<p>ËØ•ÂÆ¢Êà∑Á´ØÊ®°Êãü‰∏Ä‰∏™ÂêëÊúçÂä°Âô®ÂèëÈÄÅÊ∂àÊÅØÁöÑËøõÁ®ã„ÄÇ</p>
<h3 id="22-ÈÖçÁΩÆÁõëÂê¨Âú∞ÂùÄ-Á´ØÂè£Âíå‰∏ªÁõÆÂΩï">2.2 ÈÖçÁΩÆÁõëÂê¨Âú∞ÂùÄ„ÄÅÁ´ØÂè£Âíå‰∏ªÁõÆÂΩï</h3>
<p>ÈÖçÁΩÆÁõëÂê¨IPÂú∞ÂùÄ„ÄÅÁ´ØÂè£Âíå‰∏ªÁõÆÂΩïÔºåÊîπÂèò‰∏äËø∞ÈÖçÁΩÆ‰πãÂêé‰∏çÂÖÅËÆ∏ÈáçÊñ∞ÁºñËØëÔºåÈÇ£‰πàÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊ∑ªÂä†‰∏Ä‰∏™ÈÖçÁΩÆÊñá‰ª∂ÔºåÂ∞ÜServerÁöÑÁõëÂê¨Âú∞ÂùÄ„ÄÅÁ´ØÂè£Âíå‰∏ªÁõÆÂΩïÂ≠òÂÇ®Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÔºåÈÄöËøáËØªÊñá‰ª∂ÁöÑÊñπÂºèÊù•Ëé∑ÂèñËÆæÁΩÆÁöÑÁõëÂê¨Âú∞ÂùÄ„ÄÅÁ´ØÂè£Âíå‰∏ªÁõÆÂΩï„ÄÇ</p>
<h4 id="221-server">2.2.1 Server</h4>
<p>ÈÖçÁΩÆÊñá‰ª∂ÁöÑÂ≠òÂÇ®Ê†ºÂºèÂ¶Ç‰∏ãÔºö</p>
<img src="https://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/20221030171816.png"/>
<p>ËØªÂèñÈÖçÁΩÆÊñá‰ª∂Âπ∂Ëß£ÊûêÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre><code class="language-c++">//ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÔºåÂØπÁõëÂê¨Âú∞ÂùÄ„ÄÅÁ´ØÂè£„ÄÅ‰∏ªÁõÆÂΩïËøõË°åÈÖçÁΩÆ
string IP;//ÊúçÂä°Âô®IPÂú∞ÂùÄ
string catalogue;//‰∏ªÁõÆÂΩï
short port;//Á´ØÂè£
ifstream config;
config.open(&quot;E:/Lab1_Server/config.txt&quot;, ios::in);
if (!config.is_open()) {//ÊâìÂºÄÈÖçÁΩÆÊñá‰ª∂Â§±Ë¥•
    cout &lt;&lt; &quot;Open config file failed! &quot; &lt;&lt; endl;
}
else {
    cout &lt;&lt; &quot;Start to analyse the config file...&quot;&lt;&lt;endl;
    char buf[1024];
    memset(buf, '\0', 1024);
    while(config.getline(buf, sizeof(buf))){
        string s(buf);
        if (s.find(&quot;IP&quot;) != string::npos) {//IPÈÖçÁΩÆË°å
            IP.assign(s,3);
        }
        else if (s.find(&quot;port&quot;) != string::npos) {//Á´ØÂè£portÈÖçÁΩÆË°å
            port = short(atoi(s.substr(5).c_str()));
        }
        else if (s.find(&quot;catalogue&quot;) != string::npos) {//‰∏ªÁõÆÂΩïÈÖçÁΩÆË°å
            catalogue.assign(s, 10);
        }
    }
}
</code></pre>
<p>Âú®ÈÖçÁΩÆÁõëÂê¨Âú∞ÂùÄ‰∏éÁ´ØÂè£Â§ÑÔºåÂ∞ÜÊàë‰ª¨Ëß£ÊûêÂæóÂà∞ÁöÑIP‰∏éportËÆæÁΩÆ‰∏∫ÊúçÂä°Âô®ÁöÑIP‰∏éport</p>
<pre><code class="language-c++">//ËÆæÁΩÆÊúçÂä°Âô®ÁöÑÁ´ØÂè£ÂíåÂú∞ÂùÄ
addr.sin_family = AF_INET;
addr.sin_port = htons(port);
inet_pton(AF_INET, IP.c_str(), &amp;addr.sin_addr.s_addr);
addr.sin_addr.S_un.S_addr = htonl(INADDR_ANY);
cout &lt;&lt; &quot;Set Server IP success:&quot; &lt;&lt; IP &lt;&lt; endl;
cout &lt;&lt; &quot;Set Server port success:&quot; &lt;&lt; port &lt;&lt; endl;
</code></pre>
<p>ÁªèËøáÊµãËØïÔºåedgeÊµèËßàÂô®ÂèØ‰ª•Ê≠£Á°ÆÂæóËé∑ÂæóÁΩëÈ°µ„ÄÇ</p>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/20221030201125.png" style="zoom: 33%;" />
<p>Êàë‰ª¨‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂ <code>config.txt</code> ‰∏≠ÁöÑIPÂú∞ÂùÄÂíåÁ´ØÂè£Âè∑ÔºåÂêåÊ†∑ÂèØ‰ª•ÂÆûÁé∞ÁΩëÈ°µÁöÑËØ∑Ê±ÇÔºåÂõ†Ê≠§‰πüÂÆûÁé∞‰∫ÜÂú®ÁõëÂê¨Á´ØÂè£‰∏äËøõË°åÁõëÂê¨ÁöÑÂäüËÉΩÔºåÂêåÊó∂ÁΩëÈ°µÊ≠£Â∏∏ÂæóÊòæÂºè‰πüËØ¥Êòé‰∫ÜÊàë‰ª¨ÂΩìÂâçÁöÑÊúçÂä°Âô®ÂèØ‰ª•Âú®Êî∂Âà∞ÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÊó∂ÂàõÂª∫ËøûÊé•Â•óÊé•Â≠ó</p>
<h3 id="23-ÂìçÂ∫îÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÂÆö‰ΩçÁõ∏Â∫îÁöÑhtmlÊñá‰ª∂">2.3 ÂìçÂ∫îÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÔºåÂÆö‰ΩçÁõ∏Â∫îÁöÑhtmlÊñá‰ª∂</h3>
<p>Êàë‰ª¨‰πãÂâçÂèçÈ¶àÁªôÁΩëÈ°µÁöÑÊòØ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÔºåÂõ†Ê≠§ÁΩëÈ°µÂè™ËÉΩÊòæÁ§∫Ëøô‰∏ÄÂè•ËØùÔºåÊ≥®ÊÑèÂà∞ÁΩëÈ°µÂÜÖÂÆπÁöÑËØ∑Ê±ÇÊä•Êñá‰∏∫Ôºà‰ª•edgeÊµèËßàÂô®‰∏∫‰æãÔºâÔºö</p>
<pre><code class="language-http">GET / HTTP/1.1
Host: 127.0.0.1:5050
Connection: keep-alive
sec-ch-ua: &quot;Chromium&quot;;v=&quot;106&quot;, &quot;Microsoft Edge&quot;;v=&quot;106&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: &quot;Windows&quot;
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36 Edg/106.0.1370.52
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
</code></pre>
<p>ÁΩëÈ°µËØ∑Ê±ÇÁΩëÈ°µÂõæÊ†áÁöÑËØ∑Ê±ÇÊä•Êñá‰∏∫Ôºö</p>
<pre><code class="language-http">GET /favicon.ico HTTP/1.1
Host: 127.0.0.1:5050
Connection: keep-alive
sec-ch-ua: &quot;Chromium&quot;;v=&quot;106&quot;, &quot;Microsoft Edge&quot;;v=&quot;106&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36 Edg/106.0.1370.52
sec-ch-ua-platform: &quot;Windows&quot;
Accept: image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: no-cors
Sec-Fetch-Dest: image
Referer: http://127.0.0.1:5050/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
</code></pre>
<p>ÊµèËßàÂô®Âπ∂‰∏ç‰ºöÊòéÁ°ÆÂæóÂëäËØâÊàë‰ª¨ÂÆÉÊâÄË¶ÅËØ∑Ê±ÇÁöÑhtmlÁΩëÈ°µÊòØ‰ªÄ‰πàÔºåÊ†πÊçÆ <code>Accept</code> ËØ≠Âè•ÔºåÂÆÉÂ∏åÊúõÂæóÂà∞ÁöÑÊòØtextÊñáÊú¨ÊàñhtmlÊñá‰ª∂ÔºåÂõ†Ê≠§Êàë‰ª¨Â∏åÊúõÂ∞Ü‰∏Ä‰∏™Â≠òÂÇ®Âú®‰∏ªÁõÆÂΩï‰∏ãÁöÑhtmlÊñá‰ª∂ÂèçÈ¶àÁªôÁΩëÈ°µÔºåÈ¶ñÂÖàËÆæËÆ°Â•Ω‰∏ªÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂ÁªìÊûÑÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<img src="https://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/20221031155912.png" style="zoom:60%;" />
<p>Êàë‰ª¨Â∞ÜhtmlÊñá‰ª∂Â≠òÂÇ®Âú®‰∏ªÁõÆÂΩï‰∏ãÁöÑ <code>file</code> Êñá‰ª∂Â§π‰∏≠ÔºåÂ∞ÜÁΩëÈ°µ‰∏≠Áî®Âà∞ÁöÑÂõæÁâáÂ≠òÂÇ®Âú® <code>image</code> Êñá‰ª∂Â§π‰∏≠ÔºåÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑÁΩëÈ°µÔºö</p>
<pre><code class="language-html">&lt;html&gt;
	&lt;head&gt;
		&lt;title&gt;Test Web&lt;/title&gt;
	&lt;/head&gt;

	&lt;body&gt;
		&lt;div style=&quot;text-align: center; width: 100%;&quot;&gt;
			This is a test HTML
			&lt;img src=&quot;../image/icon.jpg&quot; /&gt;
		&lt;/div&gt;
	&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<img src="https://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/20221031160327.png" style="zoom: 33%;" />
<h4 id="231-server">2.3.1 Server</h4>
<p>‰∏∫‰∫ÜËß£ÊûêËØ∑Ê±ÇÊä•ÊñáÔºåÊàë‰ª¨Â∞ÜËØ∑Ê±ÇÊä•ÊñáÊåâÁÖß <code>\r\n</code> ÂàÜÂâ≤ÊàêËã•Âπ≤Ë°åÔºåÂ≠òÂÇ®Âú®ÂÖ®Â±Ä <code>vector</code> ‰∏≠ÔºåÂàÜÂâ≤ÂáΩÊï∞Â¶Ç‰∏ãÔºö</p>
<pre><code class="language-c++">void split(string recvData) {//ÂàáÂâ≤ÂìçÂ∫îÊä•ÊñáÔºåÊåâÁÖß\r\nÂàÜÂâ≤
	string seg(&quot;\r\n&quot;);//ÂàÜÈöîÁ¨¶
	int pos = 0;
	int size = recvData.size();
	for (int i = 0; i &lt; size; ++i) {
		pos = recvData.find(seg, i);
		if (pos != -1) {
			string s = recvData.substr(i, pos - i);
			if (s.size() &gt; 0) message.push_back(s);//message‰∏∫ÂÖ®Â±Ävector
			i = pos + seg.size() - 1;
		}
		else break;
	}
}
</code></pre>
<p>ÂàùÊ≠•ÁºñÂÜôÊûÑÈÄ†ÂìçÂ∫îÊä•ÊñáÁöÑÂáΩÊï∞Â¶Ç‰∏ãÔºåÂèØ‰ª•ÊûÑÈÄ†Áõ∏ÂÖ≥ÁöÑhtmlÊä•ÊñáÔºö</p>
<pre><code class="language-c++">string create_reponse(string recvData,string catalogue) {//ÂàõÂª∫ÂìçÂ∫îÊä•Êñá
	/*
	recvData:  ËØ∑Ê±ÇÊä•Êñá
	catalogue: ‰∏ªÁõÆÂΩï
	return:    ÂìçÂ∫îÊä•Êñá
	*/
	string resp;//ÂìçÂ∫îÊä•Êñá
	//ÂàùÂßãÂåñÁä∂ÊÄÅË°å
	const string OK(&quot;HTTP/1.1 200 OK\r\n&quot;);
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string MOVED(&quot;HTTP/1.1 301 Moved Permanently\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	const string WRONG_VERSION(&quot;HTTP/1.1 505 HTTP Version Not Supported\r\n&quot;);


	split(recvData);//Â∞ÜËØ∑Ê±ÇÊä•ÊñáÁöÑÊØè‰∏ÄË°åÂàÜÂâ≤Â≠òÂÇ®Âà∞message‰∏≠
	bool target = false;//ËØ∑Ê±ÇÊä•ÊñáÊòØÂê¶ÊåáÊòé‰∫ÜËØ∑Ê±ÇÁöÑ‰ø°ÊÅØÁöÑÁõ∏ÂØπË∑ØÂæÑ

	for (int i = 0; i &lt; message.size(); ++i) {
		if (message[i].find(&quot;GET&quot;) != -1  ||
			message[i].find(&quot;POST&quot;) != -1 ||
			message[i].find(&quot;HEAD&quot;) != -1 ||
			message[i].find(&quot;PUT&quot;) != -1  ||
			message[i].find(&quot;DELETE&quot;) != -1) {//ÂàÜÊûêËØ∑Ê±ÇË°å‰∏≠ÁöÑÁõ∏ÂØπË∑ØÂæÑ
			if (message[i].find(&quot;/ HTTP/1.1&quot;) != -1) {//Êú™ÊåáÊòéËØ∑Ê±ÇÁöÑÊñá‰ª∂ÁöÑÁõÆÂΩïÔºåÊ≠§Êó∂ÂèëÈÄÅÊàë‰ª¨ÁöÑÈªòËÆ§htmlÁΩëÈ°µ
				target = false;
			}
			else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ

			}
		}
		if (message[i].find(&quot;Accept:&quot;) != -1) {//ÂàÜÊûêAcceptËØ∑Ê±ÇÂ≠óÁ¨¶‰∏≤
			if (message[i].find(&quot;text/html&quot;) != -1) {//ËØ∑Ê±ÇhtmlÁΩëÈ°µÊàñÊñáÊú¨
				if (!target) {//ÂèëÈÄÅÈªòËÆ§htmlÁΩëÈ°µ
					//ËØªÂèñÊú¨Âú∞htmlÊñá‰ª∂
					string content;
					ifstream web;
					web.open(&quot;file/web.html&quot;, ios::in);
					char buf[1024];
					memset(buf, '\0', 1024);
					while (web.getline(buf, sizeof(buf))) {
						content.append(buf);
					}
					//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
					resp.append(OK);
					resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
					resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
					resp.append(&quot;Content-Length: &quot;).append(to_string(content.length())).append(&quot;\r\n&quot;);
					resp.append(&quot;\r\n&quot;);
					resp.append(content);
					break;
				}
				else {//ÂèëÈÄÅÊåáÂÆöÁöÑhtmlÁΩëÈ°µ
                    
				}
			}
			else if (message[i].find(&quot;image&quot;) != -1) {//ËØ∑Ê±ÇÂõæÁâá

			}
		}
	}
	return resp;
}
</code></pre>
<p>ÂΩìÊàë‰ª¨ÂêëÊµèËßàÂô®ÂèëÈÄÅÊûÑÈÄ†ÁöÑÂìçÂ∫îÊä•ÊñáÊó∂ÔºåÊàë‰ª¨Êî∂Âà∞ÁöÑËØ∑Ê±ÇÊä•Êñá‰∏≠Â§ö‰∫ÜËøôÊ†∑‰∏ÄÊù°Ôºö</p>
<pre><code class="language-http">GET /image/icon.jpg HTTP/1.1
Host: 127.0.0.1:5050
Connection: keep-alive
sec-ch-ua: &quot;Chromium&quot;;v=&quot;106&quot;, &quot;Microsoft Edge&quot;;v=&quot;106&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36 Edg/106.0.1370.52
sec-ch-ua-platform: &quot;Windows&quot;
Accept: image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: no-cors
Sec-Fetch-Dest: image
Referer: http://127.0.0.1:5050/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
</code></pre>
<p>ÊòæÁÑ∂ÔºåËøôÊ≠£ÊòØËØ∑Ê±ÇÊàë‰ª¨htmlÁΩëÈ°µ‰∏≠ÂõæÁâáÁöÑËØ∑Ê±ÇÊä•ÊñáÔºåËØ¥ÊòéÊàë‰ª¨ÂèëÈÄÅhtmlÊñá‰ª∂ÁöÑÂìçÂ∫îÊä•ÊñáË¢´ÊµèËßàÂô®Ê≠£Á°ÆÊé•Êî∂Âπ∂Ëß£Êûê‰∫ÜÔºå‰∫éÊòØÊàë‰ª¨Ëøõ‰∏ÄÊ≠•ÂÆåÂñÑÊûÑÈÄ†ÂìçÂ∫îÊä•ÊñáÁöÑÂáΩÊï∞Ôºå‰ΩøÂÖ∂ËÉΩÂ§üÂèëÈÄÅÂõæÁâáÁªôÊµèËßàÂô®ÔºåÂ¶Ç‰∏ãÔºö</p>
<pre><code class="language-c++">
		html = true;
	}
	else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ
		int pos_begin = message[0].find(&quot;/&quot;);
		int pos_end = message[0].find(&quot; HTTP/1.1&quot;);
		route = message[0].substr(pos_begin, pos_end - pos_begin);
		if (route.compare(&quot;/favicon.ico&quot;) == 0) {//ÂçïÁã¨Â§ÑÁêÜÁΩëÈ°µÂõæÊ†á
			route = &quot;/image&quot; + route;
		}
		route = catalogue + route;
		target = true;
		cout &lt;&lt; &quot;Get the request route:&quot; &lt;&lt; route &lt;&lt; endl;

		if (route.find(&quot;html&quot;) != -1) {//Ê†πÊçÆËØ∑Ê±ÇÁöÑÊñá‰ª∂ÂêçÂà§Êñ≠ÊµèËßàÂô®ÊÉ≥Ë¶Å‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
			html = true;
		}
		else if (route.find(&quot;jpg&quot;) != -1 ||
			route.find(&quot;png&quot;) != -1 ||
			route.find(&quot;webp&quot;) != -1 ||
			route.find(&quot;ico&quot;) != -1) {
			image = true;
		}
	}

	//ÈÅçÂéÜmessage,ÊâæÂà∞Accept:Ë°åÔºåËß£ÊûêÊµèËßàÂô®ÂèØÊé•ÂèóÁöÑÊñá‰ª∂Á±ªÂûã
	for (int i = 0; i &lt; message.size(); ++i) {
		if (message[i].find(&quot;Accept:&quot;) != -1) {//ÂàÜÊûêAcceptËØ∑Ê±ÇÂ≠óÁ¨¶‰∏≤
			if ((message[i].find(&quot;text/html&quot;) != -1|| message[i].find(&quot;*/*&quot;)!= -1)&amp;&amp; html) {//ËØ∑Ê±ÇhtmlÁΩëÈ°µÊàñÊñáÊú¨
				if (!target) {//ÂèëÈÄÅÈªòËÆ§htmlÁΩëÈ°µ
					//ËØªÂèñÊú¨Âú∞htmlÊñá‰ª∂
					string content;
					ifstream web;
					web.open(&quot;file/web.html&quot;, ios::in);
					char buf[1024];
					memset(buf, '\0', 1024);
					while (web.getline(buf, sizeof(buf))) {
						content.append(buf);
					}
					//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
					resp.append(OK);
					resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
					resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
					resp.append(&quot;Content-Length: &quot;).append(to_string(content.length())).append(&quot;\r\n&quot;);
					resp.append(&quot;\r\n&quot;);
					resp.append(content);

					int rtn = send(s, resp.c_str(), resp.length(), 0);
					if (rtn &gt; 0) {
						printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
					}
					break;
				}
				else {//ÂèëÈÄÅÊåáÂÆöÁöÑhtmlÁΩëÈ°µ
					break;
				}
			}
			else if ((message[i].find(&quot;image/&quot;) != -1||message[i].find(&quot;*/*&quot;) != -1)&amp;&amp;image) {//ËØ∑Ê±ÇÂõæÁâá
				//ËØªÂèñÂõæÁâáÊñá‰ª∂
				string content;
				FILE* fp = fopen(route.c_str(), &quot;rb&quot;);
				fseek(fp, 0, SEEK_END);
				int length = ftell(fp);
				fseek(fp, 0, SEEK_SET);
				//Ê†πÊçÆÂõæÂÉèÊï∞ÊçÆÈïøÂ∫¶ÂàÜÈÖçÂÜÖÂ≠òbuffer
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				resp.append(&quot;Content-Type: image/*\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
				rtn = send(s, buf, length, 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
				}
				break;
			}
		}
	}
	message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
	return;
}
</code></pre>
<p>ÂèØËßÅÊàë‰ª¨‰∏äËø∞ÁöÑÂáΩÊï∞Â§ßÊîπÔºå‰ªéÂàõÂª∫Êä•ÊñáÂèò‰∏∫‰∫ÜÂàõÂª∫Âπ∂ÂèëÈÄÅÊä•ÊñáÔºå‰∏ªË¶ÅÊòØÂõ†‰∏∫imageÂèëÈÄÅ‰∏ÄÁõ¥Â§±Ë¥•ÔºåÊúÄÂêéÂú®Ëøô‰∏™ÂáΩÊï∞‰∏≠Â∞ÜÈ¶ñÈÉ®ÂíåcontentÂàÜÂºÄÂèëÈÄÅÊâçÊàêÂäü‰º†Ëæì‰∫ÜÂõæÁâáÔºåÂèØËÉΩÊòØÂõ†‰∏∫Áº∫Â∞ë‰∫Ü</p>
<h3 id="24-ÊîØÊåÅÂ§öÁßçÁ±ªÂûãÁöÑÊñá‰ª∂‰º†Ëæì">2.4 ÊîØÊåÅÂ§öÁßçÁ±ªÂûãÁöÑÊñá‰ª∂‰º†Ëæì</h3>
<p>Âú®‰∏äËø∞htmlÁΩëÈ°µ‰∏≠Â∑≤ÁªèÂÆûÁé∞‰∫ÜhtmlÊñáÊú¨ÂíåÂõæÁâáÁöÑ‰º†ËæìÔºåÊàë‰ª¨È¶ñÂÖàÂÆåÂñÑ‰∏Ä‰∏ãÊµèËßàÂô®ËØ∑Ê±ÇËÆøÈóÆÁâπÂÆöÁΩëÈ°µÁöÑËØ∑Ê±ÇÔºåÁΩëÈ°µÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<pre><code class="language-html">&lt;html&gt;
&lt;head&gt;
 
&lt;/head&gt;
&lt;body&gt;
&lt;script&gt;
function clickEffect() {
  let balls = [];
  let longPressed = false;
  let longPress;
  let multiplier = 0;
  let width, height;
  let origin;
  let normal;
  let ctx;
  const colours = [&quot;#F73859&quot;, &quot;#14FFEC&quot;, &quot;#00E0FF&quot;, &quot;#FF99FE&quot;, &quot;#FAF15D&quot;];
  const canvas = document.createElement(&quot;canvas&quot;);
  document.body.appendChild(canvas);
  canvas.setAttribute(&quot;style&quot;, &quot;width: 100%; height: 100%; top: 0; left: 0; z-index: 99999; position: fixed; pointer-events: none;&quot;);
  const pointer = document.createElement(&quot;span&quot;);
  pointer.classList.add(&quot;pointer&quot;);
  document.body.appendChild(pointer);
 
  if (canvas.getContext &amp;&amp; window.addEventListener) {
    ctx = canvas.getContext(&quot;2d&quot;);
    updateSize();
    window.addEventListener('resize', updateSize, false);
    loop();
    window.addEventListener(&quot;mousedown&quot;, function(e) {
      pushBalls(randBetween(10, 20), e.clientX, e.clientY);
      document.body.classList.add(&quot;is-pressed&quot;);
      longPress = setTimeout(function(){
        document.body.classList.add(&quot;is-longpress&quot;);
        longPressed = true;
      }, 500);
    }, false);
    window.addEventListener(&quot;mouseup&quot;, function(e) {
      clearInterval(longPress);
      if (longPressed == true) {
        document.body.classList.remove(&quot;is-longpress&quot;);
        pushBalls(randBetween(50 + Math.ceil(multiplier), 100 + Math.ceil(multiplier)), e.clientX, e.clientY);
        longPressed = false;
      }
      document.body.classList.remove(&quot;is-pressed&quot;);
    }, false);
    window.addEventListener(&quot;mousemove&quot;, function(e) {
      let x = e.clientX;
      let y = e.clientY;
      pointer.style.top = y + &quot;px&quot;;
      pointer.style.left = x + &quot;px&quot;;
    }, false);
  } else {
    console.log(&quot;canvas or addEventListener is unsupported!&quot;);
  }
 
 
  function updateSize() {
    canvas.width = window.innerWidth * 2;
    canvas.height = window.innerHeight * 2;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.scale(2, 2);
    width = (canvas.width = window.innerWidth);
    height = (canvas.height = window.innerHeight);
    origin = {
      x: width / 2,
      y: height / 2
    };
    normal = {
      x: width / 2,
      y: height / 2
    };
  }
  class Ball {
    constructor(x = origin.x, y = origin.y) {
      this.x = x;
      this.y = y;
      this.angle = Math.PI * 2 * Math.random();
      if (longPressed == true) {
        this.multiplier = randBetween(14 + multiplier, 15 + multiplier);
      } else {
        this.multiplier = randBetween(6, 12);
      }
      this.vx = (this.multiplier + Math.random() * 0.5) * Math.cos(this.angle);
      this.vy = (this.multiplier + Math.random() * 0.5) * Math.sin(this.angle);
      this.r = randBetween(8, 12) + 3 * Math.random();
      this.color = colours[Math.floor(Math.random() * colours.length)];
    }
    update() {
      this.x += this.vx - normal.x;
      this.y += this.vy - normal.y;
      normal.x = -2 / window.innerWidth * Math.sin(this.angle);
      normal.y = -2 / window.innerHeight * Math.cos(this.angle);
      this.r -= 0.3;
      this.vx *= 0.9;
      this.vy *= 0.9;
    }
  }
 
  function pushBalls(count = 1, x = origin.x, y = origin.y) {
    for (let i = 0; i &lt; count; i++) {
      balls.push(new Ball(x, y));
    }
  }
 
  function randBetween(min, max) {
    return Math.floor(Math.random() * max) + min;
  }
 
  function loop() {
    ctx.fillStyle = &quot;rgba(255, 255, 255, 0)&quot;;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i &lt; balls.length; i++) {
      let b = balls[i];
      if (b.r &lt; 0) continue;
      ctx.fillStyle = b.color;
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2, false);
      ctx.fill();
      b.update();
    }
    if (longPressed == true) {
      multiplier += 0.2;
    } else if (!longPressed &amp;&amp; multiplier &gt;= 0) {
      multiplier -= 0.4;
    }
    removeBall();
    requestAnimationFrame(loop);
  }
 
  function removeBall() {
    for (let i = 0; i &lt; balls.length; i++) {
      let b = balls[i];
      if (b.x + b.r &lt; 0 || b.x - b.r &gt; width || b.y + b.r &lt; 0 || b.y - b.r &gt; height || b.r &lt; 0) {
        balls.splice(i, 1);
      }
    }
  }
}
clickEffect();//Ë∞ÉÁî®ÁâπÊïàÂáΩÊï∞
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>üëÜÁΩë‰∏äÁôΩÂ´ñÁöÑÁÆÄÂçïÁÇ´ÈÖ∑ÁöÑ‰ª£Á†ÅÔºåÂπ∂‰∏çÈáçË¶ÅÔºåÈáçË¶ÅÁöÑÊòØËÉΩÂê¶ËøõË°å‰º†ËæìÔºåÂÆåÂñÑÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºöÂéªÊéâ‰∫ÜtargetÁöÑÊ†áËØÜÔºà<s>ÂΩìÊó∂ÊêûÁöÑÊó∂ÂÄôÊ≤°ÊÉ≥Âà∞Â§öÊ≠§‰∏Ä‰∏æ</s>ÔºâÔºåÁî±Ê≠§Êàë‰ª¨Âü∫Êú¨ÂÆûÁé∞‰∫Ü‰º†ËæìÁΩëÈ°µ‰∏éÂõæÁâáÁöÑÂäüËÉΩ„ÄÇ</p>
<pre><code class="language-c++">void send_reponse(string recvData,string catalogue,SOCKET s) {//ÂàõÂª∫ÂìçÂ∫îÊä•ÊñáÔºåÂπ∂ÂèëÈÄÅ
	/*
	recvData:  ËØ∑Ê±ÇÊä•Êñá
	catalogue: ‰∏ªÁõÆÂΩï
	return:    ÂìçÂ∫îÊä•Êñá
	*/
	string resp;//ÂìçÂ∫îÊä•Êñá
	//ÂàùÂßãÂåñÁä∂ÊÄÅË°å
	const string OK(&quot;HTTP/1.1 200 OK\r\n&quot;);
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string MOVED(&quot;HTTP/1.1 301 Moved Permanently\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	const string WRONG_VERSION(&quot;HTTP/1.1 505 HTTP Version Not Supported\r\n&quot;);

	split(recvData);//Â∞ÜËØ∑Ê±ÇÊä•ÊñáÁöÑÊØè‰∏ÄË°åÂàÜÂâ≤Â≠òÂÇ®Âà∞message‰∏≠
	string route;//ËØ∑Ê±ÇÊä•ÊñáËØ∑Ê±ÇÁöÑÊñá‰ª∂Ë∑ØÂæÑ

	//Ê†πÊçÆËØ∑Ê±ÇË°åÂà§Êñ≠ÊµèËßàÂô®ËØ∑Ê±ÇÁöÑÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
	bool html = false;
	bool image = false;

	//Ëß£ÊûêËØ∑Ê±ÇË°åÔºåÂç≥message[0]
	if (message[0].find(&quot;/ HTTP/1.1&quot;) != -1) {//Êú™ÊåáÊòéË∑ØÂæÑ,ÂèëÈÄÅÈªòËÆ§ÁΩëÈ°µ
		route = route + catalogue + &quot;/file/web.html&quot;;
		html = true;
	}
	else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ
		int pos_begin = message[0].find(&quot;/&quot;);
		int pos_end = message[0].find(&quot; HTTP/1.1&quot;);
		route = message[0].substr(pos_begin, pos_end - pos_begin);
		if (route.compare(&quot;/favicon.ico&quot;) == 0) {//ÂçïÁã¨Â§ÑÁêÜÁΩëÈ°µÂõæÊ†á
			route = &quot;/image&quot; + route;
		}
		route = catalogue + route;
		cout &lt;&lt; &quot;Get the request route:&quot; &lt;&lt; route &lt;&lt; endl;

		if (route.find(&quot;html&quot;) != -1) {//Ê†πÊçÆËØ∑Ê±ÇÁöÑÊñá‰ª∂ÂêçÂà§Êñ≠ÊµèËßàÂô®ÊÉ≥Ë¶Å‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
			html = true;
		}
		else if (route.find(&quot;jpg&quot;) != -1 ||
			route.find(&quot;png&quot;) != -1 ||
			route.find(&quot;webp&quot;) != -1 ||
			route.find(&quot;ico&quot;) != -1) {
			image = true;
		}
	}

	//ÈÅçÂéÜmessage,ÊâæÂà∞Accept:Ë°åÔºåËß£ÊûêÊµèËßàÂô®ÂèØÊé•ÂèóÁöÑÊñá‰ª∂Á±ªÂûã
	for (int i = 0; i &lt; message.size(); ++i) {
		if (message[i].find(&quot;Accept:&quot;) != -1) {//ÂàÜÊûêAcceptËØ∑Ê±ÇÂ≠óÁ¨¶‰∏≤
			if ((message[i].find(&quot;text/html&quot;) != -1|| message[i].find(&quot;*/*&quot;)!= -1)&amp;&amp; html) {//ËØ∑Ê±ÇhtmlÁΩëÈ°µÊàñÊñáÊú¨
				//ËØªÂèñÊú¨Âú∞htmlÊñá‰ª∂
				string content;
				ifstream web;
				web.open(route.c_str(), ios::in);
				char buf[1024];
				memset(buf, '\0', 1024);
				while (web.getline(buf, sizeof(buf))) {
					content.append(buf);
				}
				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(content.length())).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);
				resp.append(content);

				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
				break;
			}
			else if ((message[i].find(&quot;image/&quot;) != -1||message[i].find(&quot;*/*&quot;) != -1)&amp;&amp;image) {//ËØ∑Ê±ÇÂõæÁâá
				//ËØªÂèñÂõæÁâáÊñá‰ª∂
				string content;
				FILE* fp = fopen(route.c_str(), &quot;rb&quot;);
				fseek(fp, 0, SEEK_END);
				int length = ftell(fp);
				fseek(fp, 0, SEEK_SET);
				//Ê†πÊçÆÂõæÂÉèÊï∞ÊçÆÈïøÂ∫¶ÂàÜÈÖçÂÜÖÂ≠òbuffer
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				resp.append(&quot;Content-Type: image/*\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
				rtn = send(s, buf, length, 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
				}
				break;
			}
		}
	}
	message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
	return;
}
</code></pre>
<p>Êàë‰ª¨ËÆøÈóÆ‰ª•‰∏ãÁΩëÂùÄÂç≥ÂèØÂæóÂà∞ÁâπÂÆöÁöÑhtmlÊñá‰ª∂Ôºö<a href="http://127.0.0.1:5050/file/effect.html">ÁÉüËä±ÁâπÊïà</a></p>
<p>‰∏∫‰∫ÜÂÆåÂñÑÂ§öÁ±ªÂûãÊñá‰ª∂ÁöÑ‰º†ËæìÔºåÊàëÂ∏åÊúõËÉΩÊ≠£Á°ÆÂæó‰º†ËæìÊµÅÂ™í‰ΩìÊñá‰ª∂ÔºåÂõ†Ê≠§ÂèÇËÄÉ‰∏Ä‰∏ãÁΩëÁªú‰∏äÁöÑËßÜÈ¢ë‰º†ËæìÊä•ÊñáÔºö</p>
<img src="https://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/web1.jpg" style="zoom:67%;" />
<h4 id="241-server">2.4.1 Server</h4>
<p>ÂèÇËÄÉÁΩëÁªú‰∏äÁöÑÊä•ÊñáËØ∑Ê±ÇÊ†ºÂºèÔºåÊàë‰ª¨‰πüÂèØ‰ª•ÂÆûÁé∞‰º†Ëæìmp4Êñá‰ª∂ÁöÑÂìçÂ∫îÊä•ÊñáÔºö</p>
<pre><code class="language-c++">void send_reponse(string recvData,string catalogue,SOCKET s) {//ÂàõÂª∫ÂìçÂ∫îÊä•ÊñáÔºåÂπ∂ÂèëÈÄÅ
	/*
	recvData:  ËØ∑Ê±ÇÊä•Êñá
	catalogue: ‰∏ªÁõÆÂΩï
	return:    ÂìçÂ∫îÊä•Êñá
	*/
	string resp;//ÂìçÂ∫îÊä•Êñá
	//ÂàùÂßãÂåñÁä∂ÊÄÅË°å
	const string OK(&quot;HTTP/1.1 200 OK\r\n&quot;);
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string MOVED(&quot;HTTP/1.1 301 Moved Permanently\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	const string WRONG_VERSION(&quot;HTTP/1.1 505 HTTP Version Not Supported\r\n&quot;);

	split(recvData);//Â∞ÜËØ∑Ê±ÇÊä•ÊñáÁöÑÊØè‰∏ÄË°åÂàÜÂâ≤Â≠òÂÇ®Âà∞message‰∏≠
	string route;//ËØ∑Ê±ÇÊä•ÊñáËØ∑Ê±ÇÁöÑÊñá‰ª∂Ë∑ØÂæÑ

	//Ê†πÊçÆËØ∑Ê±ÇË°åÂà§Êñ≠ÊµèËßàÂô®ËØ∑Ê±ÇÁöÑÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
	bool html = false;
	bool image = false;
	bool video = false;

	//Ëß£ÊûêËØ∑Ê±ÇË°åÔºåÂç≥message[0]
	if (message[0].find(&quot;/ HTTP/1.1&quot;) != -1) {//Êú™ÊåáÊòéË∑ØÂæÑ,ÂèëÈÄÅÈªòËÆ§ÁΩëÈ°µ
		route = route + catalogue + &quot;/file/web.html&quot;;
		html = true;
	}
	else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ
		int pos_begin = message[0].find(&quot;/&quot;);
		int pos_end = message[0].find(&quot; HTTP/1.1&quot;);
		route = message[0].substr(pos_begin, pos_end - pos_begin);
		if (route.compare(&quot;/favicon.ico&quot;) == 0) {//ÂçïÁã¨Â§ÑÁêÜÁΩëÈ°µÂõæÊ†á
			route = &quot;/image&quot; + route;
		}
		route = catalogue + route;
		cout &lt;&lt; &quot;Get the request route:&quot; &lt;&lt; route &lt;&lt; endl;

		if (route.find(&quot;html&quot;) != -1) {//Ê†πÊçÆËØ∑Ê±ÇÁöÑÊñá‰ª∂ÂêçÂà§Êñ≠ÊµèËßàÂô®ÊÉ≥Ë¶Å‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
			html = true;
		}
		else if (route.find(&quot;jpg&quot;) != -1 ||
			route.find(&quot;png&quot;) != -1 ||
			route.find(&quot;webp&quot;) != -1 ||
			route.find(&quot;ico&quot;) != -1) {
			image = true;
		}
		else if (route.find(&quot;mp4&quot;)!=-1) {
			video = true;
		}
	}

	//ÈÅçÂéÜmessage,ÊâæÂà∞Accept:Ë°åÔºåËß£ÊûêÊµèËßàÂô®ÂèØÊé•ÂèóÁöÑÊñá‰ª∂Á±ªÂûã
	for (int i = 0; i &lt; message.size(); ++i) {
		if (message[i].find(&quot;Accept:&quot;) != -1) {//ÂàÜÊûêAcceptËØ∑Ê±ÇÂ≠óÁ¨¶‰∏≤
			if ((message[i].find(&quot;text/html&quot;) != -1|| message[i].find(&quot;*/*&quot;)!= -1)&amp;&amp; html) {//ËØ∑Ê±ÇhtmlÁΩëÈ°µÊàñÊñáÊú¨
				//ËØªÂèñÊú¨Âú∞htmlÊñá‰ª∂
				string content;
				ifstream web;
				web.open(route.c_str(), ios::in);
				char buf[1024];
				memset(buf, '\0', 1024);
				while (web.getline(buf, sizeof(buf))) {
					content.append(buf);
				}
				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(content.length())).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);
				resp.append(content);

				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
				break;
			}
			else if ((message[i].find(&quot;image/&quot;) != -1||message[i].find(&quot;*/*&quot;) != -1)&amp;&amp;image) {//ËØ∑Ê±ÇÂõæÁâá
				//ËØªÂèñÂõæÁâáÊñá‰ª∂
				string content;
				FILE* fp = fopen(route.c_str(), &quot;rb&quot;);
				fseek(fp, 0, SEEK_END);
				int length = ftell(fp);
				fseek(fp, 0, SEEK_SET);
				//Ê†πÊçÆÂõæÂÉèÊï∞ÊçÆÈïøÂ∫¶ÂàÜÈÖçÂÜÖÂ≠òbuffer
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				resp.append(&quot;Content-Type: image/*\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
				rtn = send(s, buf, length, 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
				}
				break;
			}
			else if ((message[i].find(&quot;video/&quot;) != -1 || message[i].find(&quot;*/*&quot;) != -1) &amp;&amp; video) {
				//ËØªÂèñËßÜÈ¢ëÊñá‰ª∂
				string content;
				FILE* fp = fopen(route.c_str(), &quot;rb&quot;);
				fseek(fp, 0, SEEK_END);
				int length = ftell(fp);
				fseek(fp, 0, SEEK_SET);
				//Ê†πÊçÆÂõæÂÉèÊï∞ÊçÆÈïøÂ∫¶ÂàÜÈÖçÂÜÖÂ≠òbuffer
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				resp.append(&quot;Content-Type: video/mp4\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
				rtn = send(s, buf, length, 0);
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
				}
				break;
			}
		}
	}
	message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
	return;
}
</code></pre>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/image.png" style="zoom:67%;" />
<p>ÂèëÁé∞‰º†ËæìÊñá‰ª∂ÁöÑËøáÁ®ãÂ≠òÂú®ÂæàÂ§ßÈÉ®ÂàÜÁöÑÂÖ±ÊÄßÔºå‰∏çÂ¶®Êï¥Âêà‰∏Ä‰∏ã3‰∏™ÈÉ®ÂàÜÁöÑ‰º†Ëæì‰ª£Á†ÅÔºåÂπ∂Ê∑ªÂä†‰ª•‰∏ãÂäüËÉΩÔºö</p>
<blockquote>
<p>‚óè ÂØπ‰∫é‰∏Ä‰∫õÁßÅ‰∫∫Êñá‰ª∂ÔºàÊñá‰ª∂Âêç‰∏≠ÊúâprivateÂ≠óÊ†∑ÔºâÔºåÂÆÉ‰ª¨ÂèØ‰ª•Ë¢´Ë∑ØÂæÑÊâæÂà∞Ôºå‰ΩÜÊòØ‰∏çÂÖÅËÆ∏ÂèëÈÄÅÔºåÂèëÈÄÅ403ÂìçÂ∫îÊä•Êñá<br>
‚óè ÊâìÂºÄÊñá‰ª∂Â§±Ë¥•Êó∂Â∫îËØ•ÂèëÈÄÅ404ÂìçÂ∫îÊä•Êñá<br>
‚óè HTTPÁâàÊú¨‰∏ç‰∏∫HTTP1.1Êó∂Â∫îËØ•ÂèëÈÄÅ505ÂìçÂ∫îÊä•Êñá<br>
‚óè ÊúçÂä°Âô®Êú™‰ªéËØ∑Ê±ÇË°å‰∏≠Ëß£ÊûêÂá∫ÊúâÊïàË∑ØÂæÑÊó∂ÔºåËØ¥ÊòéËØª‰∏çÊáÇÊä•ÊñáÔºåÂèëÈÄÅ400ÂìçÂ∫îÊä•Êñá</p>
</blockquote>
<pre><code class="language-c++">void send_reponse(string recvData,string catalogue,SOCKET s) {//ÂàõÂª∫ÂìçÂ∫îÊä•ÊñáÔºåÂπ∂ÂèëÈÄÅ
	/*
	recvData:  ËØ∑Ê±ÇÊä•Êñá
	catalogue: ‰∏ªÁõÆÂΩï
	return:    ÂìçÂ∫îÊä•Êñá
	*/
	string resp;//ÂìçÂ∫îÊä•Êñá
	//ÂàùÂßãÂåñÁä∂ÊÄÅË°å
	const string OK(&quot;HTTP/1.1 200 OK\r\n&quot;);
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string MOVED(&quot;HTTP/1.1 301 Moved Permanently\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	const string WRONG_VERSION(&quot;HTTP/1.1 505 HTTP Version Not Supported\r\n&quot;);

	split(recvData);//Â∞ÜËØ∑Ê±ÇÊä•ÊñáÁöÑÊØè‰∏ÄË°åÂàÜÂâ≤Â≠òÂÇ®Âà∞message‰∏≠
	string route;//ËØ∑Ê±ÇÊä•ÊñáËØ∑Ê±ÇÁöÑÊñá‰ª∂Ë∑ØÂæÑ
	bool forbidden = false;//ËØ∑Ê±ÇÁöÑÊñá‰ª∂ÊòØÂê¶‰∏∫ÁßÅÊúâÁöÑ‰∏çÂèØËÆøÈóÆÁöÑÊñá‰ª∂

	//Ê†πÊçÆËØ∑Ê±ÇË°åÂà§Êñ≠ÊµèËßàÂô®ËØ∑Ê±ÇÁöÑÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
	bool html = false;
	bool image = false;
	bool video = false;

	//Ëß£ÊûêËØ∑Ê±ÇË°åÔºåÂç≥message[0]
	if (message[0].find(&quot;/ HTTP/1.1&quot;) != -1) {//Êú™ÊåáÊòéË∑ØÂæÑ,ÂèëÈÄÅÈªòËÆ§ÁΩëÈ°µ
		route = route + catalogue + &quot;/file/web.html&quot;;
		html = true;
	}
	else if (message[0].find(&quot;HTTP/1.1&quot;) == -1) {//HTTPÁâàÊú¨‰∏çÂØπÔºåÊàëÂè™ÊîØÊåÅHTTP1.1
		resp.append(WRONG_VERSION);
		int rtn = send(s, resp.c_str(), resp.length(), 0);
		if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
			cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
		}
		cout &lt;&lt; &quot;505 HTTP Version Not Supported! &quot;&lt;&lt; endl;
		if (rtn &gt; 0) {
			printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
		}
		message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
		return;
	}
	else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ
		int pos_begin = message[0].find(&quot;/&quot;);
		int pos_end = message[0].find(&quot; HTTP/1.1&quot;);
		route = message[0].substr(pos_begin, pos_end - pos_begin);
		if (route.compare(&quot;/favicon.ico&quot;) == 0) {//ÂçïÁã¨Â§ÑÁêÜÁΩëÈ°µÂõæÊ†á
			route = &quot;/image&quot; + route;
		}
		route = catalogue + route;
		cout &lt;&lt; &quot;Get the request route:&quot; &lt;&lt; route &lt;&lt; endl;

		if (route.find(&quot;html&quot;) != -1) {//Ê†πÊçÆËØ∑Ê±ÇÁöÑÊñá‰ª∂ÂêçÂà§Êñ≠ÊµèËßàÂô®ÊÉ≥Ë¶Å‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
			html = true;
		}
		else if (route.find(&quot;jpg&quot;) != -1 ||
			route.find(&quot;png&quot;) != -1 ||
			route.find(&quot;webp&quot;) != -1 ||
			route.find(&quot;ico&quot;) != -1) {
			image = true;
		}
		else if (route.find(&quot;mp4&quot;)!=-1) {
			video = true;
		}
	}
	bool understand = html | image | video;//Âà§Êñ≠ÊòØÂê¶ËØªÊáÇ‰∫ÜËØ∑Ê±ÇÊä•Êñá
	if (understand) {//Ê≠£Á°ÆËß£ÊûêÂá∫‰∫ÜÊä•Êñá‰∏≠ÁöÑË∑ØÂæÑ
		//Ê†πÊçÆrouteÊâìÂºÄÊñá‰ª∂Ôºö
		FILE* fp = fopen(route.c_str(), &quot;rb&quot;);

		if (fp == NULL) {//Êú™ÊâæÂà∞Êñá‰ª∂
			resp.append(NOT_FOUND);
			int rtn = send(s, resp.c_str(), resp.length(), 0);
			if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
				cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
			}
			cout &lt;&lt; &quot;404 NOT FOUND, Can't find the file whose route is:&quot; &lt;&lt; route &lt;&lt; endl;
			if (rtn &gt; 0) {
				printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
			}
		}
		else {//ÊâæÂà∞‰∫ÜÊñá‰ª∂
			if (route.find(&quot;private&quot;) != -1) {//ËØ∑Ê±ÇÁöÑÊòØÁßÅ‰∫∫ÁöÑ‰∏çÂèØÂèëÈÄÅÁöÑÊñá‰ª∂Ôºå403
				resp.append(FORBIDDEN);
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				cout &lt;&lt; &quot;403 FORBIDDEN, The request is forbidden!&quot; &lt;&lt; endl;
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}
			}
			else {//Âà§Êñ≠‰∫ÜËøô‰πàÂ§öÊ¨°Áªà‰∫éÂèØ‰ª•ÂèëÈÄÅ‰∫Ü

				//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
				fseek(fp, 0, SEEK_END);
				int length = ftell(fp);
				fseek(fp, 0, SEEK_SET);

				//Â∞ÜÊñá‰ª∂ÂÜÖÂÆπÂ≠òÂÇ®Ëá≥ÁºìÂÜ≤Âå∫
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				if (html) resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
				else if(image) resp.append(&quot;Content-Type: image/*\r\n&quot;);
				else if(video) resp.append(&quot;Content-Type: video/mp4\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);

				//ÂèëÈÄÅÈ¶ñÈÉ®
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}

				//ÂèëÈÄÅÊñá‰ª∂ÂÜÖÂÆπ
				rtn = send(s, buf, length, 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				cout &lt;&lt; &quot;200 OK, Success to send the file!&quot; &lt;&lt; endl;
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
				}
			}
		}
	}
	else {//Êú™ËØªÊáÇÊä•ÊñáÔºåÊàëÂè™ËÉΩÂèëhtml,image,mp4Ôºå‰Ω†ËØ∑Ê±ÇÁöÑÊñá‰ª∂‰∏çÊòØÊàëËÉΩËØªÊáÇÁöÑ
		resp.append(BAD_REQUEST);
		int rtn = send(s, resp.c_str(), resp.length(), 0);
		if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
			cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
		}
		cout &lt;&lt; &quot;400 Bad Request, Can't understand the recvData!&quot;&lt;&lt; endl;
		if (rtn &gt; 0) {
			printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
		}
	}
	message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
	return;
}
</code></pre>
<h3 id="25-ÊúçÂä°Âô®Â±èÂπï‰∏äÊòæÁ§∫ËØ∑Ê±ÇÊù•Ê∫ê">2.5 ÊúçÂä°Âô®Â±èÂπï‰∏äÊòæÁ§∫ËØ∑Ê±ÇÊù•Ê∫ê</h3>
<p>Êàë‰ª¨Âè™ÈúÄË¶ÅËæìÂá∫‰ºöËØùSocketÁöÑIPÂú∞ÂùÄ‰∏éÁ´ØÂè£Âè∑Âç≥ÂèØÔºåËØ∑Ê±ÇÊä•ÊñáÂ∑≤ÁªèËæìÂá∫Ëøá‰∫ÜÔºåÂõ†Ê≠§‰∏çÂÜçÂçïÁã¨ÊòæÁ§∫httpÁöÑËØ∑Ê±ÇË°å</p>
<h4 id="251-server">2.5.1 Server</h4>
<pre><code class="language-c++">//Â¶ÇÊûúsrvSockÊî∂Âà∞ËøûÊé•ËØ∑Ê±ÇÔºåÊé•ÂèóÂÆ¢Êà∑ËøûÊé•ËØ∑Ê±Ç
if (FD_ISSET(srvSocket, &amp;rfds)) {
    nTotal--;
    sessionSocket = accept(srvSocket, (LPSOCKADDR)&amp;clientAddr, &amp;addrLen);
    if (sessionSocket != INVALID_SOCKET) {
        printf(&quot;Socket listen one client request!\n&quot;);
        char str[4096];
        cout &lt;&lt; &quot;Client IP:&quot; &lt;&lt; inet_ntop(AF_INET,&amp;clientAddr.sin_addr,str,sizeof(str)) &lt;&lt; endl;
        cout &lt;&lt; &quot;Client port:&quot; &lt;&lt; htons(clientAddr.sin_port) &lt;&lt; endl;
    }
    if ((rtn = ioctlsocket(sessionSocket, FIONBIO, &amp;blockMode) == SOCKET_ERROR)) {
        cout &lt;&lt; &quot;ioctlsocket() failed with error!\n&quot;;
        return;
    }
    cout &lt;&lt; &quot;ioctlsocket() for session socket ok!	Waiting for client connection and data\n\n&quot;;
    //ËÆæÁΩÆÁ≠âÂæÖ‰ºöËØùSOKCETÂèØÊé•ÂèóÊï∞ÊçÆÊàñÂèØÂèëÈÄÅÊï∞ÊçÆ
    FD_SET(sessionSocket, &amp;rfds);
    FD_SET(sessionSocket, &amp;wfds);

    //ÊääÊñ∞ÁöÑ‰ºöËØùsocketÂä†ÂÖ•‰ºöËØùsocketÂàóË°®
    sessionSockets.push_back(sessionSocket);
}
</code></pre>
<h3 id="26-ËØ∑Ê±ÇÂ§ÑÁêÜÁªìÊûú‰∏éÈîôËØØÊèêÁ§∫">2.6 ËØ∑Ê±ÇÂ§ÑÁêÜÁªìÊûú‰∏éÈîôËØØÊèêÁ§∫</h3>
<p>Êàë‰ª¨Âú®‰∏äËø∞ÁöÑ‰ª£Á†Å‰∏≠Â∑≤ÁªèÂü∫Êú¨ÂÆûÁé∞‰∫ÜËØ∑Ê±ÇÂ§ÑÁêÜÁªìÊûúÂíåÈîôËØØÊèêÁ§∫ÁöÑÊòæÁ§∫ÔºåÂ∏åÊúõËøõ‰∏ÄÊ≠•ÂæóÂÆåÂñÑÊ≠§ÈÉ®ÂàÜÔºö</p>
<blockquote>
<p>‚óè Â∫ïÂ±ÇÂàùÂßãÂåñÈîôËØØÊó∂Ôºå‰πüËøõË°åÊä•ÈîôÔºåÂπ∂Â±ïÁ§∫ÈîôËØØ‰ª£Á†ÅÔºö</p>
<pre><code class="language-c++">/* Â∫ïÂ±ÇÂàùÂßãÂåñ */
int nRc = WSAStartup(0x0202, &amp;wsaData);
if (nRc) {
    printf(&quot;Winsock  startup failed with error!\n&quot;);
    WSAGetLastError();
}
if (wsaData.wVersion != 0x0202) {
    printf(&quot;Winsock version is not correct!\n&quot;);
    WSAGetLastError();
}
printf(&quot;Winsock  startup Ok!\n&quot;);
</code></pre>
<p>‚óè ÂàùÂßãÂåñServer SocketÊó∂Ôºå‰πüËøõË°åÊä•ÈîôÔºåÂπ∂Â±ïÁ§∫ÈîôËØØ‰ª£Á†ÅÔºö</p>
<pre><code class="language-c++">/* SocketÂàùÂßãÂåñ */
SOCKET srvSocket;
sockaddr_in addr, clientAddr;
SOCKET sessionSocket;
int addrLen;
//ÂàõÂª∫ÁõëÂê¨Socket
srvSocket = socket(AF_INET, SOCK_STREAM, 0);
if (srvSocket != INVALID_SOCKET)
    printf(&quot;Socket create Ok!\n&quot;);
else {
    cout &lt;&lt; &quot;Server Socket create failed with error!&quot; &lt;&lt; endl;
    WSAGetLastError();
}
</code></pre>
<p>‚óè Socket‰∏éÂú∞ÂùÄÂíåÁ´ØÂè£ÁªëÂÆöÊó∂Ôºå‰πüËøõË°åÊä•ÈîôÔºåÂπ∂Â±ïÁ§∫ÈîôËØØ‰ª£Á†ÅÔºö</p>
<pre><code class="language-c++">//Â∞ÜÁõëÂê¨Socket‰∏é‰∏ªÊú∫Âú∞ÂùÄÁªëÂÆö
int rtn = bind(srvSocket, (LPSOCKADDR)&amp;addr, sizeof(addr));
if (rtn != SOCKET_ERROR)
    printf(&quot;Socket bind Ok!\n&quot;);
else {
    cout &lt;&lt; &quot;Socket bind failed with error!&quot; &lt;&lt; endl;
    WSAGetLastError();
}
</code></pre>
<p>‚óè ‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Â§±Ë¥•Êó∂Ôºå‰πüËøõË°åÊä•ÈîôÔºåÂπ∂Â±ïÁ§∫ÈîôËØØ‰ª£Á†ÅÔºö</p>
<pre><code class="language-c++">sessionSocket = accept(srvSocket, (LPSOCKADDR)&amp;clientAddr, &amp;addrLen);
if (sessionSocket != INVALID_SOCKET) {
    printf(&quot;Socket listen one client request!\n&quot;);
    char str[4096];
    cout &lt;&lt; &quot;Client IP:&quot; &lt;&lt; inet_ntop(AF_INET,&amp;clientAddr.sin_addr,str,sizeof(str)) &lt;&lt; endl;
    cout &lt;&lt; &quot;Client port:&quot; &lt;&lt; htons(clientAddr.sin_port) &lt;&lt; endl;
}
else {//‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Â§±Ë¥•
    cout &lt;&lt; &quot;Failed to connect the client!&quot; &lt;&lt; endl;
    WSAGetLastError();
}
</code></pre>
<p>‚óè ÈíàÂØπÂèØÂ§çÁé∞ÁöÑ404ÔºàNOT FOUNDÔºâ„ÄÅ403ÔºàFORBIDDENÔºâ„ÄÅ400ÔºàBad RequestÔºâ‰∏âÁßçÈîôËØØÊÉÖÂÜµÔºåÂú®ÂèëÈÄÅËØ∑Ê±ÇÂìçÂ∫îÊä•Êñá‰πãÂêéÂÜçÂêëÂÆ¢Êà∑Á´ØÂèçÈ¶à‰∏ÄÂº†ÊèêÁ§∫ÂΩìÂâçÈÅáÂà∞ÁöÑÈîôËØØÁöÑÂõæÁâáÔºåËøõË°åÈîôËØØÊèêÁ§∫ÔºöÔºàÊ≤°ÈîôÔºåÊàëÂèàÂØπÂáΩÊï∞Â§ßÊîπ‰∫Ü‰∏Ä‰∏ãÔºåÂ∞ÜÂ§ÑÁêÜËøô‰∏â‰∏™ÈîôËØØÁöÑÈÉ®ÂàÜÁöÑÊä•ÊñáÊûÑÈÄ†Â∞ÅË£ÖÊàê‰∫Ü‰∏Ä‰∏™ÂáΩÊï∞ <code>error_tips()</code> Ôºâ</p>
<pre><code class="language-c++">void send_reponse(string recvData,string catalogue,SOCKET s) {//ÂàõÂª∫ÂìçÂ∫îÊä•ÊñáÔºåÂπ∂ÂèëÈÄÅ
	/*
	recvData:  ËØ∑Ê±ÇÊä•Êñá
	catalogue: ‰∏ªÁõÆÂΩï
	return:    ÂìçÂ∫îÊä•Êñá
	*/
	string resp;//ÂìçÂ∫îÊä•Êñá
	//ÂàùÂßãÂåñÁä∂ÊÄÅË°å
	const string OK(&quot;HTTP/1.1 200 OK\r\n&quot;);
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string MOVED(&quot;HTTP/1.1 301 Moved Permanently\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	const string WRONG_VERSION(&quot;HTTP/1.1 505 HTTP Version Not Supported\r\n&quot;);

	split(recvData);//Â∞ÜËØ∑Ê±ÇÊä•ÊñáÁöÑÊØè‰∏ÄË°åÂàÜÂâ≤Â≠òÂÇ®Âà∞message‰∏≠
	string route;//ËØ∑Ê±ÇÊä•ÊñáËØ∑Ê±ÇÁöÑÊñá‰ª∂Ë∑ØÂæÑ
	bool forbidden = false;//ËØ∑Ê±ÇÁöÑÊñá‰ª∂ÊòØÂê¶‰∏∫ÁßÅÊúâÁöÑ‰∏çÂèØËÆøÈóÆÁöÑÊñá‰ª∂

	//Ê†πÊçÆËØ∑Ê±ÇË°åÂà§Êñ≠ÊµèËßàÂô®ËØ∑Ê±ÇÁöÑÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
	bool html = false;
	bool image = false;
	bool video = false;

	//Ëß£ÊûêËØ∑Ê±ÇË°åÔºåÂç≥message[0]
	if (message[0].find(&quot;/ HTTP/1.1&quot;) != -1) {//Êú™ÊåáÊòéË∑ØÂæÑ,ÂèëÈÄÅÈªòËÆ§ÁΩëÈ°µ
		route = route + catalogue + &quot;/file/web.html&quot;;
		html = true;
	}
	else if (message[0].find(&quot;HTTP/1.1&quot;) == -1) {//HTTPÁâàÊú¨‰∏çÂØπÔºåÊàëÂè™ÊîØÊåÅHTTP1.1
		resp.append(WRONG_VERSION);
		int rtn = send(s, resp.c_str(), resp.length(), 0);
		if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
			cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
		}
		cout &lt;&lt; &quot;505 HTTP Version Not Supported! &quot;&lt;&lt; endl;
		if (rtn &gt; 0) {
			printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
		}
		message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
		return;
	}
	else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ
		int pos_begin = message[0].find(&quot;/&quot;);
		int pos_end = message[0].find(&quot; HTTP/1.1&quot;);
		route = message[0].substr(pos_begin, pos_end - pos_begin);
		if (route.compare(&quot;/favicon.ico&quot;) == 0) {//ÂçïÁã¨Â§ÑÁêÜÁΩëÈ°µÂõæÊ†á
			route = &quot;/image&quot; + route;
		}
		route = catalogue + route;
		cout &lt;&lt; &quot;Get the request route:&quot; &lt;&lt; route &lt;&lt; endl;

		if (route.find(&quot;html&quot;) != -1) {//Ê†πÊçÆËØ∑Ê±ÇÁöÑÊñá‰ª∂ÂêçÂà§Êñ≠ÊµèËßàÂô®ÊÉ≥Ë¶Å‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
			html = true;
		}
		else if (route.find(&quot;jpg&quot;) != -1 ||
			route.find(&quot;png&quot;) != -1 ||
			route.find(&quot;webp&quot;) != -1 ||
			route.find(&quot;ico&quot;) != -1) {
			image = true;
		}
		else if (route.find(&quot;mp4&quot;)!=-1) {
			video = true;
		}
	}
	bool understand = html | image | video;//Âà§Êñ≠ÊòØÂê¶ËØªÊáÇ‰∫ÜËØ∑Ê±ÇÊä•Êñá
	if (understand) {//Ê≠£Á°ÆËß£ÊûêÂá∫‰∫ÜÊä•Êñá‰∏≠ÁöÑË∑ØÂæÑ
		//Ê†πÊçÆrouteÊâìÂºÄÊñá‰ª∂Ôºö
		FILE* fp = fopen(route.c_str(), &quot;rb&quot;);

		if (fp == NULL) {//Êú™ÊâæÂà∞Êñá‰ª∂
			error_tips(s, 404);//ÂèçÈ¶àÈîôËØØÊèêÁ§∫ÔºåÊúçÂä°Âô®ËæìÂá∫404ÈîôËØØ
		}
		else {//ÊâæÂà∞‰∫ÜÊñá‰ª∂
			if (route.find(&quot;private&quot;) != -1) {//ËØ∑Ê±ÇÁöÑÊòØÁßÅ‰∫∫ÁöÑ‰∏çÂèØÂèëÈÄÅÁöÑÊñá‰ª∂Ôºå403
				error_tips(s, 403);
			}
			else {//Âà§Êñ≠‰∫ÜËøô‰πàÂ§öÊ¨°Áªà‰∫éÂèØ‰ª•ÂèëÈÄÅ‰∫Ü

				//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
				fseek(fp, 0, SEEK_END);
				int length = ftell(fp);
				fseek(fp, 0, SEEK_SET);

				//Â∞ÜÊñá‰ª∂ÂÜÖÂÆπÂ≠òÂÇ®Ëá≥ÁºìÂÜ≤Âå∫
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				if (html) resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
				else if(image) resp.append(&quot;Content-Type: image/*\r\n&quot;);
				else if(video) resp.append(&quot;Content-Type: video/mp4\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);

				//ÂèëÈÄÅÈ¶ñÈÉ®
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
				}

				//ÂèëÈÄÅÊñá‰ª∂ÂÜÖÂÆπ
				rtn = send(s, buf, length, 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				cout &lt;&lt; &quot;200 OK, Success to send the file!&quot; &lt;&lt; endl;
				if (rtn &gt; 0) {
					printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
				}
			}
		}
	}
	else {//Êú™ËØªÊáÇÊä•ÊñáÔºåÊàëÂè™ËÉΩÂèëhtml,image,mp4Ôºå‰Ω†ËØ∑Ê±ÇÁöÑÊñá‰ª∂‰∏çÊòØÊàëËÉΩËØªÊáÇÁöÑ
		error_tips(s, 400);
	}
	message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
	return;
}
</code></pre>
<pre><code class="language-c++">void error_tips(SOCKET s,int problem) {
	//ÈîôËØØÊèêÁ§∫
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	//ÂèëÈÄÅÈîôËØØÊèêÁ§∫ÂõæÁâá‚Äî‚ÄîÂç≥ÂèëÈÄÅ‰∏Ä‰∏™ÂåÖÂê´ÂõæÁâáÁöÑhtmlÁΩëÈ°µ
	string error;
	string route;

	if (problem == 404) {
		route = route + &quot;file/404.html&quot;;
		cout &lt;&lt; &quot;404 NOT FOUND, Can't find the file whose route is:&quot; &lt;&lt; route &lt;&lt; endl;
		error.append(NOT_FOUND);
	}
	else if (problem == 403) {
		route = route + &quot;file/403.html&quot;;
		cout &lt;&lt; &quot;403 FORBIDDEN, The request is forbidden!&quot; &lt;&lt; endl;
		error.append(FORBIDDEN);
	}
	else if (problem == 400) {
		route = route + &quot;file/400.html&quot;;
		cout &lt;&lt; &quot;400 Bad Request, Can't understand the recvData!&quot; &lt;&lt; endl;
		error.append(BAD_REQUEST);
	}

	FILE* fp = fopen(route.c_str(), &quot;rb&quot;);
	//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
	fseek(fp, 0, SEEK_END);
	int length = ftell(fp);
	fseek(fp, 0, SEEK_SET);
	//Â∞ÜÊñá‰ª∂ÂÜÖÂÆπÂ≠òÂÇ®Ëá≥ÁºìÂÜ≤Âå∫
	char* buf = (char*)malloc(length + 1);
	memset(buf, '\0', length + 1);
	fread(buf, length, 1, fp);
	fclose(fp);
	error.append(&quot;Server: VerySimpleServer\r\n&quot;);
	error.append(&quot;Content-Type: text/html\r\n&quot;);
	error.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
	error.append(&quot;\r\n&quot;);
	//ÂèëÈÄÅÈ¶ñÈÉ®
	int rtn = send(s, error.c_str(), error.length(), 0);
	if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
		cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
	}
	if (rtn &gt; 0) {
		printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, error.c_str());
	}
	//ÂèëÈÄÅÊñá‰ª∂ÂÜÖÂÆπ
	rtn = send(s, buf, length, 0);
	if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
		cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
	}
	if (rtn &gt; 0) {
		printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, buf);
	}
	return;
}
</code></pre>
</blockquote>
<p>ÊúÄÁªà‰ºòÂåñÊïàÊûúÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>
<p>404ÔºöË∑ØÂæÑÊó†ÊïàÔºåÊâæ‰∏çÂà∞Êñá‰ª∂</p>
<pre><code class="language-http">127.0.0.1:5050/invalid.png
</code></pre>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/404.png" style="zoom: 23%;" />
</li>
<li>
<p>403ÔºöË∑ØÂæÑÊúâÊïàÔºå‰ΩÜËØ∑Ê±ÇÁöÑÊòØÈùûÊ≥ïÊñá‰ª∂</p>
<pre><code class="language-http">127.0.0.1:5050/image/private.png
</code></pre>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/403.png" style="zoom:23%;" />
</li>
<li>
<p>400ÔºöËØ∑Ê±ÇÁöÑÊñá‰ª∂‰∏çÊòØhtml„ÄÅimage„ÄÅvideo‰∏≠ÁöÑ‰∏Ä‰∏™ÔºàÊ≠§Â§ÑËÆæÂÆöÁöÑÊòØ400‰ºòÂÖàÁ∫ßÈ´ò‰∫é404Ôºâ</p>
<pre><code class="language-http">127.0.0.1:5050/file/web.css
</code></pre>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/400.png" style="zoom:23%;" />
</li>
</ul>
<h3 id="27-ÂºÇÂ∏∏Â§ÑÁêÜ">2.7 ÂºÇÂ∏∏Â§ÑÁêÜ</h3>
<p>Êàë‰ª¨ËøòÂ∏åÊúõÊúçÂä°Âô®Êúâ‰∏ÄÂÆöÁöÑÂºÇÂ∏∏Â§ÑÁêÜËÉΩÂäõÔºåÊàëÊ≠§Â§ÑÂÖ≥Ê≥®Âà∞ÁöÑÊòØÂΩìÂâç‰ª£Á†Å‰∏≠ÁöÑwarningÈÉ®ÂàÜÔºö</p>
<img src="http://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/IZM660X_3GEYEILL)G7~J[Y.png" style="zoom:50%;" />
<p>Âõ†Ê≠§Ê∑ªÂä†‰∏Ä‰∏™ÂàÜÊîØ‰ª•ÈÅøÂÖçÊ∫¢Âá∫Ôºö</p>
<pre><code class="language-c++">//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
fseek(fp, 0, SEEK_END);
long long length = ftell(fp);
fseek(fp, 0, SEEK_SET);

if (length &gt;= 4294967295) {//Êñá‰ª∂ËøáÂ§ßÔºåÂëäÁü•ÊµèËßàÂô®Áî≥ËØ∑ÁöÑÊñá‰ª∂ËøáÂ§ßÔºåÊó†Ê≥ïÂèëÈÄÅÔºåÈÅøÂÖçÊ∫¢Âá∫
    cout &lt;&lt; &quot;The file which has been requested is too big!&quot; &lt;&lt; endl;
    string content(&quot;The file which has been requested is too big!&quot;);
    resp.append(FORBIDDEN);
    resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
    resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
    resp.append(&quot;Content-Length: &quot;).append(to_string(content.length())).append(&quot;\r\n&quot;);
    resp.append(&quot;\r\n&quot;);
    resp.append(content);
    int rtn = send(s, resp.c_str(), resp.length(), 0);
    if (rtn &gt; 0) {
        printf(&quot;\nSend %d bytes to client: \n%s\n&quot;, rtn, resp.c_str());
    }
    message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
    return;
}

//Â∞ÜÊñá‰ª∂ÂÜÖÂÆπÂ≠òÂÇ®Ëá≥ÁºìÂÜ≤Âå∫
char* buf = (char*)malloc(length + 1);
memset(buf, '\0', length + 1);
fread(buf, length, 1, fp);
fclose(fp);
</code></pre>
<h3 id="28-ÊúçÂä°Âô®ÂÆåÂñÑ">2.8 ÊúçÂä°Âô®ÂÆåÂñÑ</h3>
<p>ÊúÄÁªàÂØπÊàë‰ª¨ÁöÑÊúçÂä°Âô®ËøõË°å‰∏ÄÂÆöÁöÑÂÆåÂñÑÔºå‰∏∫ÂêÑ‰∏™ÊèêÁ§∫Ê∑ªÂä†È¢úËâ≤Ôºå‰ΩøÂÖ∂Êõ¥Âä†Áõ¥ËßÇÔºåÊúÄÁªàÂæóÂà∞ÁöÑÊúçÂä°Âô®‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre><code class="language-c++">#define _CRT_SECURE_NO_WARNINGS
#pragma once
#include &quot;winsock2.h&quot;
#include &lt;windows.h&gt;
#include &lt;Ws2tcpip.h&gt;
#include &lt;stdio.h&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;list&gt;
#include &lt;vector&gt;
#include &lt;fstream&gt;
using namespace std;

#pragma comment(lib,&quot;ws2_32.lib&quot;)

list&lt;SOCKET&gt; sessionSockets;//‰ºöËØùSocketÂàóË°®
vector&lt;string&gt; message;//ÂìçÂ∫îÊä•ÊñáÊåâÁÖß/r/nÂàÜÂâ≤ÂêéÂ≠òÂÇ®Âú®message‰∏≠

void color(int x);//ËÆæÁΩÆÂ≠ó‰ΩìÈ¢úËâ≤
void split(string recvData);//ÂàíÂàÜËØ∑Ê±ÇÊä•Êñá
void send_reponse(string recvData, string catalogue,SOCKET s);//ÂàõÂª∫Âπ∂ÂèëÈÄÅÂìçÂ∫îÊä•Êñá
void error_tips(SOCKET s, int problem);//ÈîôËØØÊèêÁ§∫

void main(){
	system(&quot;color F0&quot;);
	WSADATA wsaData;
	fd_set rfds;//Áî®‰∫éÊ£ÄÊü•socketÊòØÂê¶ÊúâÊï∞ÊçÆÂà∞Êù•ÁöÑÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶
	fd_set wfds;//Áî®‰∫éÊ£ÄÊü•socketÊòØÂê¶ÂèØ‰ª•ÂèëÈÄÅÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶

	/* Â∫ïÂ±ÇÂàùÂßãÂåñ */
	int nRc = WSAStartup(0x0202, &amp;wsaData);
	if (nRc) {
		color(252); printf(&quot;Winsock  startup failed with error!\n&quot;);
		WSAGetLastError();
	}
	if (wsaData.wVersion != 0x0202) {
		color(252); printf(&quot;Winsock version is not correct!\n&quot;);
		WSAGetLastError();
	}
	color(242); printf(&quot;Winsock  startup Ok!\n&quot;);

	//ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÔºåÂØπÁõëÂê¨Âú∞ÂùÄ„ÄÅÁ´ØÂè£„ÄÅ‰∏ªÁõÆÂΩïËøõË°åÈÖçÁΩÆ
	string IP;//ÊúçÂä°Âô®IPÂú∞ÂùÄ
	string catalogue;//‰∏ªÁõÆÂΩï
	short port = 0;//Á´ØÂè£
	ifstream config;
	config.open(&quot;E:/Lab1_Server/config.txt&quot;, ios::in);
	if (!config.is_open()) {//ÊâìÂºÄÈÖçÁΩÆÊñá‰ª∂Â§±Ë¥•
		color(252); cout &lt;&lt; &quot;Open config file failed! &quot; &lt;&lt; endl;
		return;
	}
	else {
		color(242); cout &lt;&lt; &quot;Open config file success! &quot;&lt;&lt;endl;
		char buf[1024];
		memset(buf, '\0', 1024);
		while(config.getline(buf, sizeof(buf))){
			string s(buf);
			if (s.find(&quot;IP&quot;) != string::npos) {//IPÈÖçÁΩÆË°å
				IP.assign(s,3);
			}
			else if (s.find(&quot;port&quot;) != string::npos) {//Á´ØÂè£portÈÖçÁΩÆË°å
				port = short(atoi(s.substr(5).c_str()));
			}
			else if (s.find(&quot;catalogue&quot;) != string::npos) {//‰∏ªÁõÆÂΩïÈÖçÁΩÆË°å
				catalogue.assign(s, 10);
			}
		}
	}
	color(242); cout &lt;&lt; &quot;Analyse config file success!&quot; &lt;&lt; endl;

	/* SocketÂàùÂßãÂåñ */
	SOCKET srvSocket;
	sockaddr_in addr, clientAddr;
	SOCKET sessionSocket;
	int addrLen;
	//ÂàõÂª∫ÁõëÂê¨Socket
	srvSocket = socket(AF_INET, SOCK_STREAM, 0);
	if (srvSocket != INVALID_SOCKET) {
		color(242); printf(&quot;Socket create Ok!\n&quot;);
	}
	else {
		color(252); cout &lt;&lt; &quot;Server Socket create failed with error!&quot; &lt;&lt; endl;
		WSAGetLastError();
	}


	//ËÆæÁΩÆÊúçÂä°Âô®ÁöÑÁ´ØÂè£ÂíåÂú∞ÂùÄ
	addr.sin_family = AF_INET;
	addr.sin_port = htons(port);
	inet_pton(AF_INET, IP.c_str(), &amp;addr.sin_addr.s_addr);
	addr.sin_addr.S_un.S_addr = htonl(INADDR_ANY);
	color(241); cout &lt;&lt; &quot;Set Server IP success:&quot; &lt;&lt; IP &lt;&lt; endl;
	color(241); cout &lt;&lt; &quot;Set Server port success:&quot; &lt;&lt; port &lt;&lt; endl;

	//Â∞ÜÁõëÂê¨Socket‰∏é‰∏ªÊú∫Âú∞ÂùÄÁªëÂÆö
	int rtn = bind(srvSocket, (LPSOCKADDR)&amp;addr, sizeof(addr));
	if (rtn != SOCKET_ERROR) {
		color(242); printf(&quot;Socket bind Ok!\n&quot;);
	}
	else {
		color(252); cout &lt;&lt; &quot;Socket bind failed with error!&quot; &lt;&lt; endl;
		WSAGetLastError();
	}

	/* ÁõëÂê¨ */
	rtn = listen(srvSocket, 5);
	if (rtn != SOCKET_ERROR) {
		color(242); printf(&quot;Socket listen Ok!\n&quot;);
	}
	else {
		color(252); cout &lt;&lt; &quot;Socket listen failed with error!&quot; &lt;&lt; endl;
		WSAGetLastError();
	}
	clientAddr.sin_family = AF_INET;
	addrLen = sizeof(clientAddr);
	char recvBuf[4096];
	u_long blockMode = 1;
	if ((rtn = ioctlsocket(srvSocket, FIONBIO, &amp;blockMode) == SOCKET_ERROR)) {
		color(252); cout &lt;&lt; &quot;ioctlsocket() failed with error!\n&quot;;
		WSAGetLastError();
		return;
	}
	color(242); cout &lt;&lt; &quot;ioctlsocket() for server socket ok!	Waiting for client connection and data\n\n&quot;;


	/* ÁõëÂê¨ClientÊï∞ÊçÆ */
	while (true) {
		//Ê∏ÖÁ©∫rfdsÂíåwfdsÊï∞ÁªÑÔºåÂπ∂Á≠âÂæÖÂÆ¢Êà∑ËØ∑Ê±Ç
		FD_ZERO(&amp;rfds);
		FD_ZERO(&amp;wfds);
		FD_SET(srvSocket, &amp;rfds);


		for (list&lt;SOCKET&gt;::iterator itor = sessionSockets.begin(); itor != sessionSockets.end(); itor++) {
			//ËÆæÁΩÆÁ≠âÂæÖÊâÄÊúâ‰ºöËØùSOKCETÂèØÊé•ÂèóÊï∞ÊçÆÊàñÂèØÂèëÈÄÅÊï∞ÊçÆ
			FD_SET(*itor, &amp;rfds);
			FD_SET(*itor, &amp;wfds);
		}

		//ËøîÂõûÊÄªÂÖ±ÂèØ‰ª•ËØªÊàñÂÜôÁöÑÂè•ÊüÑ‰∏™Êï∞
		int nTotal = select(0, &amp;rfds, &amp;wfds, NULL, NULL);
		//Â¶ÇÊûúsrvSockÊî∂Âà∞ËøûÊé•ËØ∑Ê±ÇÔºåÊé•ÂèóÂÆ¢Êà∑ËøûÊé•ËØ∑Ê±Ç
		if (FD_ISSET(srvSocket, &amp;rfds)) {
			nTotal--;
			sessionSocket = accept(srvSocket, (LPSOCKADDR)&amp;clientAddr, &amp;addrLen);
			if (sessionSocket != INVALID_SOCKET) {
				color(242); printf(&quot;Socket listen one client request!\n&quot;);
				char str[4096];
				color(241); cout &lt;&lt; &quot;Client IP:&quot; &lt;&lt; inet_ntop(AF_INET,&amp;clientAddr.sin_addr,str,sizeof(str)) &lt;&lt; endl;
				color(241); cout &lt;&lt; &quot;Client port:&quot; &lt;&lt; htons(clientAddr.sin_port) &lt;&lt; endl;
			}
			else {//‰∏éÂÆ¢Êà∑Á´ØËøûÊé•Â§±Ë¥•
				color(252); cout &lt;&lt; &quot;Failed to connect the client!&quot; &lt;&lt; endl;
				WSAGetLastError();
			}
			if ((rtn = ioctlsocket(sessionSocket, FIONBIO, &amp;blockMode) == SOCKET_ERROR)) {
				color(252); cout &lt;&lt; &quot;ioctlsocket() failed with error!\n&quot;;
				WSAGetLastError();
				return;
			}
			color(242); cout &lt;&lt; &quot;ioctlsocket() for session socket ok!	Waiting for client connection and data\n\n&quot;;
			//ËÆæÁΩÆÁ≠âÂæÖ‰ºöËØùSOKCETÂèØÊé•ÂèóÊï∞ÊçÆÊàñÂèØÂèëÈÄÅÊï∞ÊçÆ
			FD_SET(sessionSocket, &amp;rfds);
			FD_SET(sessionSocket, &amp;wfds);

			//ÊääÊñ∞ÁöÑ‰ºöËØùsocketÂä†ÂÖ•‰ºöËØùsocketÂàóË°®
			sessionSockets.push_back(sessionSocket);
		}

		//Ê£ÄÊü•‰ºöËØùSOCKETÊòØÂê¶ÊúâÊï∞ÊçÆÂà∞Êù•
		if (nTotal &gt; 0) {
			for (list&lt;SOCKET&gt;::iterator itor = sessionSockets.begin(); itor != sessionSockets.end(); itor++) {
				if (FD_ISSET(*itor, &amp;rfds)) { //Â¶ÇÊûúÈÅçÂéÜÂà∞ÁöÑÂΩìÂâçsocketÊúâÊï∞ÊçÆÂà∞Êù•
					//receiving data from client
					memset(recvBuf, '\0', 4096);
					rtn = recv(*itor, recvBuf, 4096, 0);
					if (rtn &gt; 0) {
						color(242); printf(&quot;\nReceived %d bytes from client: \n&quot;, rtn);
						color(244); cout &lt;&lt; recvBuf &lt;&lt; endl;
						//ÂêëÊúçÂä°Âô®ÂèëÈÄÅÂìçÂ∫î
						if (FD_ISSET(*itor, &amp;wfds)) {//ÈÅçÂ¶ÇÊûúÂéÜÂà∞ÁöÑÂΩìÂâçsocketÂèØÂèëÈÄÅÊï∞ÊçÆ
							string recvData(recvBuf);//ËØ∑Ê±ÇÊä•Êñá
							send_reponse(recvData,catalogue,*itor);//ÊûÑÂª∫ÂìçÂ∫îÊä•ÊñáÂπ∂ÂèëÈÄÅ
						}
					}
				}
			}
		}
	}
}
void color(int x){
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), x);//ËÆæÁΩÆ‰∏çÂêåÊï∞Â≠óÁöÑÈ¢úËâ≤
}

void split(string recvData) {//ÂàáÂâ≤ÂìçÂ∫îÊä•ÊñáÔºåÊåâÁÖß\r\nÂàÜÂâ≤
	string seg(&quot;\r\n&quot;);//ÂàÜÈöîÁ¨¶
	int pos = 0;
	int size = recvData.size();
	for (int i = 0; i &lt; size; ++i) {
		pos = recvData.find(seg, i);
		if (pos != -1) {
			string s = recvData.substr(i, pos - i);
			if (s.size() &gt; 0) message.push_back(s);
			i = pos + seg.size() - 1;
		}
		else break;
	}
}

void send_reponse(string recvData,string catalogue,SOCKET s) {//ÂàõÂª∫ÂìçÂ∫îÊä•ÊñáÔºåÂπ∂ÂèëÈÄÅ
	/*
	recvData:  ËØ∑Ê±ÇÊä•Êñá
	catalogue: ‰∏ªÁõÆÂΩï
	return:    ÂìçÂ∫îÊä•Êñá
	*/
	string resp;//ÂìçÂ∫îÊä•Êñá
	//ÂàùÂßãÂåñÁä∂ÊÄÅË°å
	const string OK(&quot;HTTP/1.1 200 OK\r\n&quot;);
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string MOVED(&quot;HTTP/1.1 301 Moved Permanently\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	const string WRONG_VERSION(&quot;HTTP/1.1 505 HTTP Version Not Supported\r\n&quot;);

	split(recvData);//Â∞ÜËØ∑Ê±ÇÊä•ÊñáÁöÑÊØè‰∏ÄË°åÂàÜÂâ≤Â≠òÂÇ®Âà∞message‰∏≠
	string route;//ËØ∑Ê±ÇÊä•ÊñáËØ∑Ê±ÇÁöÑÊñá‰ª∂Ë∑ØÂæÑ
	bool forbidden = false;//ËØ∑Ê±ÇÁöÑÊñá‰ª∂ÊòØÂê¶‰∏∫ÁßÅÊúâÁöÑ‰∏çÂèØËÆøÈóÆÁöÑÊñá‰ª∂

	//Ê†πÊçÆËØ∑Ê±ÇË°åÂà§Êñ≠ÊµèËßàÂô®ËØ∑Ê±ÇÁöÑÊòØ‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
	bool html = false;
	bool image = false;
	bool video = false;

	//Ëß£ÊûêËØ∑Ê±ÇË°åÔºåÂç≥message[0]
	if (message[0].find(&quot;/ HTTP/1.1&quot;) != -1) {//Êú™ÊåáÊòéË∑ØÂæÑ,ÂèëÈÄÅÈªòËÆ§ÁΩëÈ°µ
		route = route + catalogue + &quot;/file/web.html&quot;;
		html = true;
	}
	else if (message[0].find(&quot;HTTP/1.1&quot;) == -1) {//HTTPÁâàÊú¨‰∏çÂØπÔºåÊàëÂè™ÊîØÊåÅHTTP1.1
		resp.append(WRONG_VERSION);
		int rtn = send(s, resp.c_str(), resp.length(), 0);
		if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
			color(252); cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
		}
		color(252); cout &lt;&lt; &quot;505 HTTP Version Not Supported! &quot;&lt;&lt; endl;
		if (rtn &gt; 0) {
			color(242); printf(&quot;\nSend %d bytes to client: \n&quot;, rtn);
			color(244); cout &lt;&lt; resp &lt;&lt; endl;
		}
		message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
		return;
	}
	else {//ÂàÜÊûêÂá∫Áõ∏ÂØπË∑ØÂæÑÔºåÁªìÂêà‰∏ªÁõÆÂΩïÂΩ¢ÊàêÁªùÂØπË∑ØÂæÑ
		int pos_begin = message[0].find(&quot;/&quot;);
		int pos_end = message[0].find(&quot; HTTP/1.1&quot;);
		route = message[0].substr(pos_begin, pos_end - pos_begin);
		if (route.compare(&quot;/favicon.ico&quot;) == 0) {//ÂçïÁã¨Â§ÑÁêÜÁΩëÈ°µÂõæÊ†á
			route = &quot;/image&quot; + route;
		}
		route = catalogue + route;
		color(242); cout &lt;&lt; &quot;Get the request route:&quot; ;
		color(244); cout &lt;&lt; route &lt;&lt; endl;

		if (route.find(&quot;html&quot;) != -1) {//Ê†πÊçÆËØ∑Ê±ÇÁöÑÊñá‰ª∂ÂêçÂà§Êñ≠ÊµèËßàÂô®ÊÉ≥Ë¶Å‰ªÄ‰πàÁ±ªÂûãÁöÑÊñá‰ª∂
			html = true;
		}
		else if (route.find(&quot;jpg&quot;) != -1 ||
			route.find(&quot;png&quot;) != -1 ||
			route.find(&quot;webp&quot;) != -1 ||
			route.find(&quot;ico&quot;) != -1) {
			image = true;
		}
		else if (route.find(&quot;mp4&quot;)!=-1) {
			video = true;
		}
	}
	bool understand = html | image | video;//Âà§Êñ≠ÊòØÂê¶ËØªÊáÇ‰∫ÜËØ∑Ê±ÇÊä•Êñá
	if (understand) {//Ê≠£Á°ÆËß£ÊûêÂá∫‰∫ÜÊä•Êñá‰∏≠ÁöÑË∑ØÂæÑ
		//Ê†πÊçÆrouteÊâìÂºÄÊñá‰ª∂Ôºö
		FILE* fp = fopen(route.c_str(), &quot;rb&quot;);

		if (fp == NULL) {//Êú™ÊâæÂà∞Êñá‰ª∂
			error_tips(s, 404);//ÂèçÈ¶àÈîôËØØÊèêÁ§∫ÔºåÊúçÂä°Âô®ËæìÂá∫404ÈîôËØØ
		}
		else {//ÊâæÂà∞‰∫ÜÊñá‰ª∂
			if (route.find(&quot;private&quot;) != -1) {//ËØ∑Ê±ÇÁöÑÊòØÁßÅ‰∫∫ÁöÑ‰∏çÂèØÂèëÈÄÅÁöÑÊñá‰ª∂Ôºå403
				error_tips(s, 403);
			}
			else {//Âà§Êñ≠‰∫ÜËøô‰πàÂ§öÊ¨°Áªà‰∫éÂèØ‰ª•ÂèëÈÄÅ‰∫Ü

				//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
				fseek(fp, 0, SEEK_END);
				long long length = ftell(fp);
				fseek(fp, 0, SEEK_SET);

				if (length &gt;= 4294967295) {//Êñá‰ª∂ËøáÂ§ßÔºåÂëäÁü•ÊµèËßàÂô®Áî≥ËØ∑ÁöÑÊñá‰ª∂ËøáÂ§ßÔºåÊó†Ê≥ïÂèëÈÄÅÔºåÈÅøÂÖçÊ∫¢Âá∫
					color(252); cout &lt;&lt; &quot;The file which has been requested is too big!&quot; &lt;&lt; endl;
					string content(&quot;The file which has been requested is too big!&quot;);
					resp.append(FORBIDDEN);
					resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
					resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
					resp.append(&quot;Content-Length: &quot;).append(to_string(content.length())).append(&quot;\r\n&quot;);
					resp.append(&quot;\r\n&quot;);
					resp.append(content);
					int rtn = send(s, resp.c_str(), resp.length(), 0);
					if (rtn &gt; 0) {
						color(242); printf(&quot;\nSend %d bytes to client: \n&quot;, rtn);
						color(244); cout &lt;&lt; resp &lt;&lt; endl;
					}
					message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
					return;
				}

				//Â∞ÜÊñá‰ª∂ÂÜÖÂÆπÂ≠òÂÇ®Ëá≥ÁºìÂÜ≤Âå∫
				char* buf = (char*)malloc(length + 1);
				memset(buf, '\0', length + 1);
				fread(buf, length, 1, fp);
				fclose(fp);

				//ÊûÑÈÄ†ÂìçÂ∫îÊä•Êñá
				resp.append(OK);
				resp.append(&quot;Server: VerySimpleServer\r\n&quot;);
				if (html) resp.append(&quot;Content-Type: text/html; charset=ISO-8859-1\r\n&quot;);
				else if(image) resp.append(&quot;Content-Type: image/*\r\n&quot;);
				else if(video) resp.append(&quot;Content-Type: video/mp4\r\n&quot;);
				resp.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
				resp.append(&quot;\r\n&quot;);

				//ÂèëÈÄÅÈ¶ñÈÉ®
				int rtn = send(s, resp.c_str(), resp.length(), 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					color(252); cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				if (rtn &gt; 0) {
					color(242); printf(&quot;\nSend %d bytes to client: \n&quot;, rtn);
					color(244); cout &lt;&lt; resp &lt;&lt; endl;
				}

				//ÂèëÈÄÅÊñá‰ª∂ÂÜÖÂÆπ
				rtn = send(s, buf, length, 0);
				if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
					color(252); cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
				}
				color(242); cout &lt;&lt; &quot;200 OK, Success to send the file!&quot; &lt;&lt; endl;
				if (rtn &gt; 0) {
					color(242); printf(&quot;\nSend %d bytes to client: \n&quot;, rtn);
					color(244); cout &lt;&lt; buf &lt;&lt; endl;
				}
			}
		}
	}
	else {//Êú™ËØªÊáÇÊä•ÊñáÔºåÊàëÂè™ËÉΩÂèëhtml,image,mp4Ôºå‰Ω†ËØ∑Ê±ÇÁöÑÊñá‰ª∂‰∏çÊòØÊàëËÉΩËØªÊáÇÁöÑ
		error_tips(s, 400);
	}
	message.clear();//Ê≥®ÊÑèËøîÂõûÂâç‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫messageÔºå‰ª•‰æø‰∏ãÊ¨°‰ΩøÁî®
	return;
}

void error_tips(SOCKET s,int problem) {
	//ÈîôËØØÊèêÁ§∫
	const string NOT_FOUND(&quot;HTTP/1.1 404 NOT FOUND\r\n&quot;);
	const string FORBIDDEN(&quot;HTTP/1.1 403 FORBIDDEN\r\n&quot;);
	const string BAD_REQUEST(&quot;HTTP/1.1 400 Bad Request\r\n&quot;);
	//ÂèëÈÄÅÈîôËØØÊèêÁ§∫ÂõæÁâá‚Äî‚ÄîÂç≥ÂèëÈÄÅ‰∏Ä‰∏™ÂåÖÂê´ÂõæÁâáÁöÑhtmlÁΩëÈ°µ
	string error;
	string route;

	if (problem == 404) {
		route = route + &quot;file/404.html&quot;;
		color(245); cout &lt;&lt; &quot;404 NOT FOUND, Can't find the file &quot;&lt;&lt; endl;
		error.append(NOT_FOUND);
	}
	else if (problem == 403) {
		route = route + &quot;file/403.html&quot;;
		color(245); cout &lt;&lt; &quot;403 FORBIDDEN, The request is forbidden!&quot; &lt;&lt; endl;
		error.append(FORBIDDEN);
	}
	else if (problem == 400) {
		route = route + &quot;file/400.html&quot;;
		color(245); cout &lt;&lt; &quot;400 Bad Request, Can't understand the recvData!&quot; &lt;&lt; endl;
		error.append(BAD_REQUEST);
	}

	FILE* fp = fopen(route.c_str(), &quot;rb&quot;);
	//Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞è
	fseek(fp, 0, SEEK_END);
	int length = ftell(fp);
	fseek(fp, 0, SEEK_SET);
	//Â∞ÜÊñá‰ª∂ÂÜÖÂÆπÂ≠òÂÇ®Ëá≥ÁºìÂÜ≤Âå∫
	char* buf = (char*)malloc(length + 1);
	memset(buf, '\0', length + 1);
	fread(buf, length, 1, fp);
	fclose(fp);
	error.append(&quot;Server: VerySimpleServer\r\n&quot;);
	error.append(&quot;Content-Type: text/html\r\n&quot;);
	error.append(&quot;Content-Length: &quot;).append(to_string(length)).append(&quot;\r\n&quot;);
	error.append(&quot;\r\n&quot;);
	//ÂèëÈÄÅÈ¶ñÈÉ®
	int rtn = send(s, error.c_str(), error.length(), 0);
	if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
		color(252); cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
	}
	if (rtn &gt; 0) {
		color(242); printf(&quot;\nSend %d bytes to client: \n&quot;, rtn);
		color(244); cout &lt;&lt; error &lt;&lt; endl;
	}
	//ÂèëÈÄÅÊñá‰ª∂ÂÜÖÂÆπ
	rtn = send(s, buf, length, 0);
	if (rtn == SOCKET_ERROR) {//ÊòæÁ§∫Â§ÑÁêÜÁªìÊûú
		color(252); cout &lt;&lt; &quot;Failed to send!&quot; &lt;&lt; endl;
	}
	if (rtn &gt; 0) {
		color(242); printf(&quot;\nSend %d bytes to client: \n&quot;, rtn);
		color(244); cout &lt;&lt; buf &lt;&lt; endl;
	}
	return;
}
</code></pre>

            </div>
            <hr style="width: 80%;">
            
            <div class="postfooter">
                <ul class="post-copyright">
                    <li><strong>ÊñáÁ´†‰ΩúËÄÖÔºö</strong>w_CS</li>
            <li><strong>ÂéüÊñáÈìæÊé•Ôºö</strong>https://2006wzt.github.io/post/socketÁºñÁ®ãÂÆûÈ™å/</li>
            <li><strong>ÁâàÊùÉÂ£∞ÊòéÔºö</strong>Êú¨ÂçöÂÆ¢ÊâÄÊúâÊñáÁ´†Èô§ÁâπÂà´Â£∞ÊòéÂ§ñÔºåÂùáÈááÁî®<i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA
                ËÆ∏ÂèØÂçèËÆÆ„ÄÇËΩ¨ËΩΩËØ∑Ê≥®ÊòéÂá∫Â§ÑÔºÅ</li>
            </ul>
        </div>
        
            <div class="shareContainer">
                <div class="share" style="height:30px;">
                    <a class="qq" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/qqs.png" alt=""></i></a>
                    <a class="wechat" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/wechats.png" alt=""></i></a>
                    <a class="weibo" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/weibos.png" alt=""></i></a>
                    <a class="qzone" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/qzones.png" alt=""></i></a>
                    <a class="douban" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/doubans.png" alt=""></i></a>
                    <a class="facebook" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/facebooks.png" alt=""></i></a>
                    <a class="twitter" href=""><i><img class="shareicon"
                                src="https://2006wzt.github.io/media/images/twitter.png" alt=""></i></a>
                </div>
            </div>
            
        <div id="otherpost">
            
            
            <a data-pjax class="next-post-pc" href="https://2006wzt.github.io/post/CSP-Á≤æÁªÉ/"  style="color: black;">
                <div id="npcontainer">
                    
                    <img src="https://2006wzt.github.io/post-images/CSP-Á≤æÁªÉ.png" style="width: 100%;" class="opimg">
                    
                    <h4 class="optitle">CSP-Á≤æÁÇº</h4>
                </div>
            </a>
            <div class="next-post">
                ‰∏ã‰∏ÄÁØá <a  data-pjax href="https://2006wzt.github.io/post/CSP-Á≤æÁªÉ/">CSP-Á≤æÁÇº</a>
            </div>
            
        </div>
    </div>
    </div>
    </div>
    <!-- ÂºπÁ™ó -->
    <div id="myModal" class="modal">
        <img class="modal-content" id="img01">
    </div>
</body>
<script>
    //ÊñáÁ´†ÈòÖËØªÁÉ≠Â∫¶
    var pl = $("#pl").html();
    var rootaddr = $("#rootaddr").html();
    pl = pl.replace(rootaddr, "");
    $("#hotnum").attr('id', pl);
</script>
                    <div class="toc-container">
                        <ul class="markdownIt-TOC">
<li><a href="#socket%E7%BC%96%E7%A8%8B%E5%AE%9E%E9%AA%8C">SocketÁºñÁ®ãÂÆûÈ™å</a>
<ul>
<li><a href="#%E4%B8%80-%E5%AE%9E%E9%AA%8C%E8%A6%81%E6%B1%82">‰∏Ä„ÄÅÂÆûÈ™åË¶ÅÊ±Ç</a>
<ul>
<li><a href="#11-%E5%AE%9E%E9%AA%8C%E7%9B%AE%E6%A0%87%E5%92%8C%E5%86%85%E5%AE%B9">1.1 ÂÆûÈ™åÁõÆÊ†áÂíåÂÜÖÂÆπ</a>
<ul>
<li><a href="#111-%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84">1.1.1 ÂÆûÈ™åÁõÆÁöÑ</a></li>
<li><a href="#112-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83">1.1.2 ÂÆûÈ™åÁéØÂ¢É</a></li>
<li><a href="#113-%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9">1.1.3 ÂÆûÈ™åÂÜÖÂÆπ</a></li>
</ul>
</li>
<li><a href="#12-%E6%A3%80%E6%9F%A5%E8%A1%A8">1.2 Ê£ÄÊü•Ë°®</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0">‰∫å„ÄÅÂäüËÉΩÂÆûÁé∞</a>
<ul>
<li><a href="#21-server%E5%92%8Cclient%E7%AE%80%E5%8D%95demo">2.1 ServerÂíåClientÁÆÄÂçïDemo</a>
<ul>
<li><a href="#211-server">2.1.1 Server</a></li>
<li><a href="#212-client">2.1.2 Client</a></li>
</ul>
</li>
<li><a href="#22-%E9%85%8D%E7%BD%AE%E7%9B%91%E5%90%AC%E5%9C%B0%E5%9D%80-%E7%AB%AF%E5%8F%A3%E5%92%8C%E4%B8%BB%E7%9B%AE%E5%BD%95">2.2 ÈÖçÁΩÆÁõëÂê¨Âú∞ÂùÄ„ÄÅÁ´ØÂè£Âíå‰∏ªÁõÆÂΩï</a>
<ul>
<li><a href="#221-server">2.2.1 Server</a></li>
</ul>
</li>
<li><a href="#23-%E5%93%8D%E5%BA%94%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%E5%AE%9A%E4%BD%8D%E7%9B%B8%E5%BA%94%E7%9A%84html%E6%96%87%E4%BB%B6">2.3 ÂìçÂ∫îÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÔºåÂÆö‰ΩçÁõ∏Â∫îÁöÑhtmlÊñá‰ª∂</a>
<ul>
<li><a href="#231-server">2.3.1 Server</a></li>
</ul>
</li>
<li><a href="#24-%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93">2.4 ÊîØÊåÅÂ§öÁßçÁ±ªÂûãÁöÑÊñá‰ª∂‰º†Ëæì</a>
<ul>
<li><a href="#241-server">2.4.1 Server</a></li>
</ul>
</li>
<li><a href="#25-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E6%98%BE%E7%A4%BA%E8%AF%B7%E6%B1%82%E6%9D%A5%E6%BA%90">2.5 ÊúçÂä°Âô®Â±èÂπï‰∏äÊòæÁ§∫ËØ∑Ê±ÇÊù•Ê∫ê</a>
<ul>
<li><a href="#251-server">2.5.1 Server</a></li>
</ul>
</li>
<li><a href="#26-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E7%BB%93%E6%9E%9C%E4%B8%8E%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA">2.6 ËØ∑Ê±ÇÂ§ÑÁêÜÁªìÊûú‰∏éÈîôËØØÊèêÁ§∫</a></li>
<li><a href="#27-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">2.7 ÂºÇÂ∏∏Â§ÑÁêÜ</a></li>
<li><a href="#28-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%8C%E5%96%84">2.8 ÊúçÂä°Âô®ÂÆåÂñÑ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                    </div>
                    <div class="tog">
                        <div class="toggleContainer">
                            <div class="toggle">
                                <i class="fas fa-angle-double-up"></i>
                            </div>
                        </div>
                    </div>
                    <!---------------------------- ËØÑËÆ∫Á≥ªÁªüüëá ------------------------->
                    <div id="comment" class="comment">
                        <div class="commentcontainer">
                            
                                
                            
                        </div>
                    </div>
                    <!---------------------------- ËØÑËÆ∫Á≥ªÁªüüëÜ ------------------------->
                </div>
                <!-- mainÊ†áÁ≠æÔºåpjaxÊ∏≤ÊüìÊó∂Âä†ËΩΩ‰ª•‰∏äÂÜÖÂÆπüëÜ -->
                <div class="col-md-1 col-lg-2"></div>
                <div id="bg">
                </div>
            </div>
            <!-- ----------------Â∑¶‰æßËèúÂçïÊ†èhtml üëÜ-------------------------------------->
            
        </div>
        <!-- aplayerÊí≠ÊîæÂô®Âä†ËΩΩüëá -->
            
        <!-- aplayerÊí≠ÊîæÂô®Âä†ËΩΩüëÜ -->
    </div>
    <!-- ËÉåÊôØÂõæÂä†ËΩΩÊñπÂºèüëá -->
    <div id="bgchoice" style="display: none">link
                </div>
                
                <div id="bgurl" style="display:none">https://raw.githubusercontent.com/2006wzt/PicGo_images/master/images/background.png</div>
                
    <!-- ËÉåÊôØÂõæÂä†ËΩΩÊñπÂºèüëÜ -->
</body>

<script>
    //ÂàùÂßãÂåñ
    //Êõ¥Êç¢twikooÂ§¥ÂÉè
    setTimeout(replaceAvatar,1000);
    setTimeout(replaceAvatar,2000);
    setTimeout(replaceAvatar,8000);
    // --------‰∏∫ÊØèÂº†ÂõæÁâáÊ∑ªÂä†ÊáíÂä†ËΩΩÔºàlazyloadÔºâÊ†áÁ≠æ-->ÊáíÂä†ËΩΩÂäüËÉΩ üëá------------
    lazyload();
    //‰∏∫ÊñáÁ´†ÂÜÖÊâÄÊúâ‰ª£Á†ÅÂùóÊ∑ªÂä†‰ª£Á†ÅÂ§çÂà∂ÂäüËÉΩ üëá
    codeinit();
    // ------‰ª£Á†ÅÈ´ò‰∫ÆÊòæÁ§∫ÂäüËÉΩ-------------
    hljs.initHighlightingOnLoad();
    if (shareChoice)
        shareInit();
    if (donateChoice)
        donateInit();
</script>

<!------------------ Âä†ËΩΩlive2dÊ®°ÂûãÂäüËÉΩÔºàÁúãÊùøÂ®òÔºâüëá ---------------->

<script type="text/javascript">
    var message_Path = '/live2d/'
    var home_Path = document.getElementById("domainname").innerHTML + "/"; //Ê≠§Â§Ñ‰øÆÊîπ‰∏∫‰Ω†ÁöÑÂüüÂêçÔºåÂøÖÈ°ªÂ∏¶ÊñúÊù†
</script>
<script type="text/javascript" src="https://2006wzt.github.io/media/js/live2d.js"></script>
<script type="text/javascript" src="https://2006wzt.github.io/media/live2d/js/message.js"></script>
<script type="text/javascript">
    loadlive2d("live2d", "https://2006wzt.github.io/media/live2d/assets/tororo.model.json");
</script>

<!------------------ Âä†ËΩΩlive2dÊ®°ÂûãÂäüËÉΩÔºàÁúãÊùøÂ®òÔºâüëÜ ---------------->


<!----------------------- ËøîÂõûÈ°∂ÈÉ®ÊåâÈíÆÂäüËÉΩüëá --------------------->
<script>
    $(function () {
        $('.toggleContainer').click(function () {
            $('html,body').animate({
                scrollTop: '0px'
            }, 800);
        });
        $(window).scroll(function () {
            var st = $(window).scrollTop();
            if (st > 30) {
                $(".toggleContainer").fadeIn(400);
            } else {
                $(".toggleContainer").fadeOut(100);
            }
        });
    });
</script>
<!----------------------- ËøîÂõûÈ°∂ÈÉ®ÊåâÈíÆÂäüËÉΩüëÜ --------------------->


<!------------ Âä†ËΩΩÂÖ®Â±ÄËÉåÊôØÂõæÂäüËÉΩüëáÔºàÂºÄÂßãÊó∂Ê≤°ÊúâÂÜôÂ•ΩÔºåËøôÂäüËÉΩÊúâÁÇπÈ∏°ËÇã/(„Ñío„Ñí)/~~Ôºâ -->
<script>
    var bgchoice = "link"
    var bg = $('#bg');
    var bgurl = document.getElementById("bgurl").innerHTML;
    if (bgchoice == 'default')
    {
        for (var i = 0; i < 3; i++)
            bgurl = bgurl.replace("\\", "/");
        bgurl = "https://2006wzt.github.io/" + bgurl;
    }
    bg.css("background", "url('" + bgurl + "')");

    window.onload = function () {
        aplayerbtnInit();
    }
</script>
<!------------ Âä†ËΩΩÂÖ®Â±ÄËÉåÊôØÂõæÂäüËÉΩüëÜÔºàÂºÄÂßãÊó∂Ê≤°ÊúâÂÜôÂ•ΩÔºåËøôÂäüËÉΩÊúâÁÇπÈ∏°ËÇã/(„Ñío„Ñí)/~~Ôºâ -->




<script src="https://2006wzt.github.io/media/js/index.js"></script>


<script>
    //Âä†ËΩΩÂêéÁöÑ‰∫ã‰ª∂ÂêåÊ≠•ÔºàÈòÖËØªÈáè„ÄÅÁßªÂä®Á´ØËØÑËÆ∫Á≠â
    window.onload = function () {
    //‰ª£Á†ÅÂùóÈ´ò‰∫ÆÊ∏≤Êüì
    document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
    });
        getHotnum();
        var sharepc = $(".share").eq(0).html();
        $(".share").eq(1).html(sharepc);   //Êèí‰ª∂Âè™‰ºöÂØªÊâæ‰∏Ä‰∏™ÂàÜ‰∫´Ê†áÁ≠æÊ∏≤ÊüìÔºåÊâÄ‰ª•ÈúÄË¶ÅÊâãÂä®Ê∑ªÂä†Âà∞ÁßªÂä®Á´Ø
        aplayerbtnInit();
        $(".hljs").css({
            "padding": "20px"
        })
    }
</script>

<!-- <script src="https://2006wzt.github.io/media/js/av-min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.13.0/dist/av-min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.6.1/dist/av-live-query-min.js"></script> -->